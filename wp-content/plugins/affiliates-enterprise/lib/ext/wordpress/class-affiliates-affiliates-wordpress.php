<?php
class Affiliates_Affiliates_WordPress extends Affiliates_Affiliates { public function view() { global $wpdb, $wp_rewrite, $affiliates_options; global $affiliates_db; $IXAP34 = ''; $IXAP83 = date( 'Y-m-d', time() ); $IXAP5 = get_option( 'aff_pname', AFFILIATES_PNAME ); if ( !current_user_can( AFFILIATES_ADMINISTER_AFFILIATES ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } $notice = ''; if ( isset( $_POST['action'] ) ) { $notice_msg = ''; switch( $_POST['action'] ) { case 'add' : $IXAP11 = affiliates_admin_affiliates_add_submit(); if ( !empty( $IXAP11['errors'] ) ) { $_POST['errors'] = $IXAP11['errors']; return affiliates_admin_affiliates_add(); } $notice_msg = __( 'Affiliate added.', 'affiliates' ); break; case 'edit' : $IXAP273 = new Affiliates_Affiliate_WordPress(); $IXAP11 = $IXAP273->edit_submit(); if ( !empty( $IXAP11['errors'] ) ) { $_POST['errors'] = $IXAP11['errors']; return $IXAP273->edit( $_POST['affiliate-id-field'] ); } $notice_msg = __( 'Affiliate updated.', 'affiliates' ); break; case 'remove' : affiliates_admin_affiliates_remove_submit(); $notice_msg = __( 'Affiliate removed.', 'affiliates' ); break; case 'add-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); if ( !$IXAP274->add_submit() ) { if ( isset( $_POST['affiliate_id'] ) ) { return $IXAP274->add( $_POST['affiliate_id' ] ); } } else { $IXAP273 = new Affiliates_Affiliate_WordPress(); return $IXAP273->edit( $_POST['affiliate_id'] ); } break; case 'edit-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); if ( !$IXAP274->edit_submit() ) { if ( isset( $_POST['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP274->edit( $_POST['affiliate_id' ], $_GET['attr_key'] ); } } else { $IXAP273 = new Affiliates_Affiliate_WordPress(); return $IXAP273->edit( $_POST['affiliate_id'] ); } break; case 'remove-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); $IXAP274->remove_submit(); $IXAP273 = new Affiliates_Affiliate_WordPress(); return $IXAP273->edit( $_POST['affiliate_id'] ); break; case 'add-relation' : break; case 'edit-relation' : break; case 'remove-relation' : break; case 'affiliate-action' : if ( wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_ACTION_NONCE], 'admin' ) ) { $affiliate_ids = isset( $_POST['affiliate_ids'] ) ? $_POST['affiliate_ids'] : null; $IXAP275 = null; if ( isset( $_POST['bulk'] ) ) { $IXAP275 = $_POST['bulk-action']; } if ( is_array( $affiliate_ids ) && ( $IXAP275 !== null ) ) { foreach ( $affiliate_ids as $affiliate_id ) { switch ( $IXAP275 ) { case 'remove-affiliate' : $IXAP276 = isset( $_POST['confirm'] ) ? true : false; if ( $IXAP276 ) { affiliates_admin_affiliates_bulk_remove_submit(); } else { return affiliates_admin_affiliates_bulk_remove(); } break; case 'status-active' : affiliates_admin_affiliates_bulk_status_active_submit(); break; case 'status-pending' : affiliates_admin_affiliates_bulk_status_pending_submit(); break; } } } } $notice_msg = __( 'Bulk action executed', 'affiliates' ); break; } $notice .= '<div class="updated">'; $notice .= $notice_msg; $notice .= '</div>'; } else if ( isset ( $_GET['action'] ) ) { switch( $_GET['action'] ) { case 'add' : return affiliates_admin_affiliates_add(); break; case 'edit' : if ( isset( $_GET['affiliate_id'] ) ) { $IXAP273 = new Affiliates_Affiliate_WordPress(); return $IXAP273->edit( $_GET['affiliate_id'] ); } break; case 'remove' : if ( isset( $_GET['affiliate_id'] ) ) { return affiliates_admin_affiliates_remove( $_GET['affiliate_id'] ); } break; case 'add-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) ) { return $IXAP274->add( $_GET['affiliate_id' ] ); } break; case 'edit-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP274->edit( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'remove-attribute' : $IXAP274 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP274->remove( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'add-relation' : break; case 'edit-relation' : break; case 'remove-relation' : break; } } if ( isset( $_POST['clear_filters'] ) || isset( $_POST['submitted'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP15 = $affiliates_options->get_option( 'affiliates_from_date', null ); $IXAP20 = null; $IXAP16 = $affiliates_options->get_option( 'affiliates_thru_date', null ); $IXAP21 = null; $affiliate_id = $affiliates_options->get_option( 'affiliates_affiliate_id', null ); $affiliate_name = $affiliates_options->get_option( 'affiliates_affiliate_name', null ); $affiliate_email = $affiliates_options->get_option( 'affiliates_affiliate_email', null ); $affiliate_user_login = $affiliates_options->get_option( 'affiliates_affiliate_user_login', null ); $show_active = $affiliates_options->get_option( 'affiliates_show_active', true ); $show_pending = $affiliates_options->get_option( 'affiliates_show_pending', true ); $show_deleted = $affiliates_options->get_option( 'affiliates_show_deleted', false ); $show_inoperative = $affiliates_options->get_option( 'affiliates_show_inoperative', false ); $show_totals = $affiliates_options->get_option( 'affiliates_show_totals', true ); if ( isset( $_POST['clear_filters'] ) ) { $affiliates_options->delete_option( 'affiliates_from_date' ); $affiliates_options->delete_option( 'affiliates_thru_date' ); $affiliates_options->delete_option( 'affiliates_affiliate_id' ); $affiliates_options->delete_option( 'affiliates_affiliate_name' ); $affiliates_options->delete_option( 'affiliates_affiliate_email' ); $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); $affiliates_options->delete_option( 'affiliates_show_deleted' ); $affiliates_options->delete_option( 'affiliates_show_inoperative' ); $affiliates_options->delete_option( 'affiliates_show_totals' ); $IXAP15 = null; $IXAP20 = null; $IXAP16 = null; $IXAP21 = null; $affiliate_id = null; $affiliate_name = null; $affiliate_email = null; $affiliate_user_login = null; $show_active = true; $show_pending = true; $show_deleted = false; $show_inoperative = false; $show_totals = true; } else if ( isset( $_POST['submitted'] ) ) { if ( !empty( $_POST['affiliate_name'] ) ) { $affiliate_name = trim( $_POST['affiliate_name'] ); if ( strlen( $affiliate_name ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_name', $affiliate_name ); } else { $affiliate_name = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } } else { $affiliate_name = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } if ( !empty( $_POST['affiliate_email'] ) ) { $affiliate_email = trim( $_POST['affiliate_email'] ); if ( strlen( $affiliate_email ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_email', $affiliate_email ); } else { $affiliate_email = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } } else { $affiliate_email = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } if ( !empty( $_POST['affiliate_user_login'] ) ) { $affiliate_user_login = trim( $_POST['affiliate_user_login'] ); if ( strlen( $affiliate_user_login ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_user_login', $affiliate_user_login ); } else { $affiliate_user_login = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } } else { $affiliate_user_login = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } $show_active = isset( $_POST['show_active'] ); $affiliates_options->update_option( 'affiliates_show_active', $show_active ); $show_pending = isset( $_POST['show_pending'] ); $affiliates_options->update_option( 'affiliates_show_pending', $show_pending ); $show_deleted = isset( $_POST['show_deleted'] ); $affiliates_options->update_option( 'affiliates_show_deleted', $show_deleted ); $show_inoperative = isset( $_POST['show_inoperative'] ); $affiliates_options->update_option( 'affiliates_show_inoperative', $show_inoperative ); $show_totals = isset( $_POST['show_totals'] ); $affiliates_options->update_option( 'affiliates_show_totals', $show_totals ); if ( !empty( $_POST['from_date'] ) ) { $IXAP15 = date( 'Y-m-d', strtotime( $_POST['from_date'] ) ); $affiliates_options->update_option( 'affiliates_from_date', $IXAP15 ); } else { $affiliates_options->delete_option( 'affiliates_from_date' ); } if ( !empty( $_POST['thru_date'] ) ) { $IXAP16 = date( 'Y-m-d', strtotime( $_POST['thru_date'] ) ); $affiliates_options->update_option( 'affiliates_thru_date', $IXAP16 ); } else { $affiliates_options->delete_option( 'affiliates_thru_date' ); } if ( $IXAP15 && $IXAP16 ) { if ( strtotime( $IXAP15 ) > strtotime( $IXAP16 ) ) { $IXAP16 = null; $affiliates_options->delete_option( 'affiliates_thru_date' ); } } if ( $IXAP15 ) { $IXAP20 = DateHelper::u2s( $IXAP15 ); } if ( $IXAP16 ) { $IXAP21 = DateHelper::u2s( $IXAP16, 24*3600 ); } if ( !empty( $_POST['affiliate_id'] ) ) { $affiliate_id = affiliates_check_affiliate_id( $_POST['affiliate_id'] ); if ( $affiliate_id ) { $affiliates_options->update_option( 'affiliates_affiliate_id', $affiliate_id ); } } else if ( isset( $_POST['affiliate_id'] ) ) { $affiliate_id = null; $affiliates_options->delete_option( 'affiliates_affiliate_id' ); } } if ( isset( $_POST['row_count'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_1], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } if ( isset( $_POST['paged'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_2], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP59 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IXAP59 = remove_query_arg( 'paged', $IXAP59 ); $IXAP59 = remove_query_arg( 'action', $IXAP59 ); $IXAP59 = remove_query_arg( 'affiliate_id', $IXAP59 ); $affiliates_table = _affiliates_get_tablename( 'affiliates' ); $affiliates_users_table = _affiliates_get_tablename( 'affiliates_users' ); $affiliates_attributes_table = _affiliates_get_tablename( 'affiliates_attributes' ); $IXAP34 .= '<div class="manage-affiliates">' . '<h1>' . __( 'Manage Affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</h1>'; $IXAP34 .= $notice; $show_filters = $affiliates_options->get_option( 'show_filters', true ); $show_columns = $affiliates_options->get_option( 'show_columns', true ); $IXAP34 .= '<div class="manage">'; $IXAP34 .= "<a title='" . __( 'Click to add a new affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "' class='button add' href='" . esc_url( $IXAP59 ) . "&action=add'><img class='icon' alt='" . __( 'Add', AFFILIATES_PRO_PLUGIN_DOMAIN) . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/add.png'/><span class='label'>" . __( 'New Affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN) . "</span></a>"; $IXAP34 .= '<div style="float:right">'; $IXAP34 .= '<div style="display:inline">'; $IXAP34 .= '<form style="display:inline" id="export-affiliates" action="" method="post">'; $IXAP34 .= sprintf( '<input class="button" type="submit" value="%s" />', __( 'Export', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); $IXAP34 .= '<input type="hidden" name="action" value="export" />'; $IXAP34 .= wp_nonce_field( 'export-affiliates', 'export-nonce', true, false ); $IXAP34 .= '</form>'; $IXAP34 .= '</div>'; $IXAP34 .= ' '; $IXAP34 .= sprintf( '<div class="button toggle-button %s" id="filters-toggle">', ( $show_filters ? 'on' : 'off' ) ); $IXAP34 .= __( 'Filters', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</div>'; $IXAP34 .= ' '; $IXAP34 .= sprintf( '<div class="button toggle-button %s" id="columns-toggle">', ( $show_columns ? 'on' : 'off' ) ); $IXAP34 .= __( 'Columns', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; $IXAP247 = isset( $_POST['row_count'] ) ? intval( $_POST['row_count'] ) : 0; if ($IXAP247 <= 0) { $IXAP247 = $affiliates_options->get_option( 'affiliates_per_page', AFFILIATES_AFFILIATES_PER_PAGE ); } else { $affiliates_options->update_option('affiliates_per_page', $IXAP247 ); } $IXAP248 = isset( $_GET['offset'] ) ? intval( $_GET['offset'] ) : 0; if ( $IXAP248 < 0 ) { $IXAP248 = 0; } $IXAP249 = isset( $_REQUEST['paged'] ) ? intval( $_REQUEST['paged'] ) : 0; if ( $IXAP249 < 0 ) { $IXAP249 = 0; } $IXAP68 = isset( $_GET['orderby'] ) ? $_GET['orderby'] : null; switch ( $IXAP68 ) { case 'from_date' : case 'thru_date' : case 'email' : case 'affiliate_id' : case 'name' : case 'user_login' : break; default: $IXAP68 = 'name'; } $IXAP69 = isset( $_GET['order'] ) ? $_GET['order'] : null; switch ( $IXAP69 ) { case 'asc' : case 'ASC' : $switch_order = 'DESC'; break; case 'desc' : case 'DESC' : $switch_order = 'ASC'; break; default: $IXAP69 = 'ASC'; $switch_order = 'DESC'; } $IXAP179 = array( " 1=%d " ); $IXAP180 = array( 1 ); if ( $affiliate_id ) { $IXAP179[] = " $affiliates_table.affiliate_id = %d "; $IXAP180[] = $affiliate_id; } if ( $affiliate_name ) { $IXAP179[] = " $affiliates_table.name LIKE '%%%s%%' "; $IXAP180[] = $affiliate_name; } if ( $affiliate_email ) { $IXAP179[] = " $affiliates_table.email LIKE '%%%s%%' "; $IXAP180[] = $affiliate_email; } if ( $affiliate_user_login ) { $IXAP179[] = " $wpdb->users.user_login LIKE '%%%s%%' "; $IXAP180[] = $affiliate_user_login; } $statuses = array( '' ); if ( $show_active ) { $statuses[] = 'active'; } if ( $show_pending ) { $statuses[] = 'pending'; } if ( $show_deleted ) { $statuses[] = 'deleted'; } $IXAP179[] = sprintf( " $affiliates_table.status IN (%s) ", !empty($statuses) ? "'" . implode( "','", $statuses ) . "'" : '' ); if ( !$show_inoperative ) { $IXAP179[] = " $affiliates_table.from_date <= %s AND ( $affiliates_table.thru_date IS NULL OR $affiliates_table.thru_date >= %s ) "; $IXAP180[] = $IXAP83; $IXAP180[] = $IXAP83; } if ( $IXAP20 && $IXAP21 ) { $IXAP179[] = " $affiliates_table.from_date >= %s AND ( $affiliates_table.thru_date IS NULL OR $affiliates_table.thru_date < %s ) "; $IXAP180[] = $IXAP20; $IXAP180[] = $IXAP21; } else if ( $IXAP20 ) { $IXAP179[] = " $affiliates_table.from_date >= %s "; $IXAP180[] = $IXAP20; } else if ( $IXAP21 ) { $IXAP179[] = " $affiliates_table.thru_date < %s "; $IXAP180[] = $IXAP21; } if ( !empty( $IXAP179 ) ) { $IXAP179 = " WHERE " . implode( " AND ", $IXAP179 ); } else { $IXAP179 = ''; } $IXAP250 = $wpdb->prepare( "SELECT COUNT(*) FROM $affiliates_table LEFT JOIN $affiliates_users_table ON $affiliates_table.affiliate_id = $affiliates_users_table.affiliate_id LEFT JOIN $wpdb->users on $affiliates_users_table.user_id = $wpdb->users.ID $IXAP179", $IXAP180 ); $IXAP251 = $wpdb->get_var( $IXAP250 ); if ( $IXAP251 > $IXAP247 ) { $IXAP252 = true; } else { $IXAP252 = false; } $IXAP75 = ceil ( $IXAP251 / $IXAP247 ); if ( $IXAP249 > $IXAP75 ) { $IXAP249 = $IXAP75; } if ( $IXAP249 != 0 ) { $IXAP248 = ( $IXAP249 - 1 ) * $IXAP247; } $IXAP3 = $wpdb->prepare( "SELECT $affiliates_table.*, $wpdb->users.* " . "FROM $affiliates_table " . "LEFT JOIN $affiliates_users_table ON $affiliates_table.affiliate_id = $affiliates_users_table.affiliate_id " . "LEFT JOIN $wpdb->users on $affiliates_users_table.user_id = $wpdb->users.ID " . "$IXAP179 " . "ORDER BY $IXAP68 $IXAP69 " . "LIMIT $IXAP247 OFFSET $IXAP248", $IXAP180 ); $IXAP26 = $wpdb->get_results( $IXAP3, OBJECT ); $IXAP105 = array( 'affiliate_id' => __( 'Id', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'name' => __( 'Affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'email' => __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'user_login' => __( 'Username', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'from_date' => __( 'From', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'thru_date' => __( 'Until', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'status' => __( 'Status', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'links' => __( 'Links', AFFILIATES_PRO_PLUGIN_DOMAIN ), ); $IXAP105 = $IXAP105 + Affiliates_Attributes::get_keys(); require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings.php'; require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings-registration.php'; $registration_fields = Affiliates_Settings_Registration::get_fields(); foreach( Affiliates_Registration::get_skip_meta_fields() as $key ) { unset( $registration_fields[$key] ); } if ( !empty( $registration_fields ) ) { foreach( $registration_fields as $name => $field ) { if ( $field['enabled'] ) { $IXAP105[$name] = stripslashes( $field['label'] ); } } } $IXAP199 = array(); foreach( array_keys( $IXAP105 ) as $key ) { $key = preg_replace( '/(\.|\-)/', '_', $key ); switch( $key ) { case 'name' : case 'email' : case 'user_login' : $IXAP199[$key] = true; break; default : $IXAP199[$key] = false; } } $affiliates_overview_columns = $IXAP199; foreach( $affiliates_options->get_option( 'affiliates_overview_columns', array() ) as $key => $value ) { $affiliates_overview_columns[$key] = $value; } $IXAP277 = 0; $IXAP34 .= '<script type="text/javascript">'; $IXAP34 .= 'affiliates_overview_columns={'; $IXAP278 = array(); foreach( $affiliates_overview_columns as $key => $value ) { $IXAP278[] = wp_strip_all_tags( $key ).':' . ( $value ? 'true' : 'false' ); if ( $value ) { $IXAP277++; } } $IXAP277++; $IXAP34 .= implode( ',', $IXAP278 ); $IXAP34 .= '};'; $IXAP34 .= '</script>'; $IXAP34 .= '<div class="affiliates-overview">'; $IXAP34 .= sprintf( '<div id="filters-container" class="filters" style="%s">', $show_filters ? '' : 'display:none' ); $IXAP34 .= '<label class="description" for="setfilters">' . __( 'Filters', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>'; $IXAP34 .= '<div>'; $IXAP34 .= '<form id="setfilters" action="" method="post">'; $IXAP34 .= '<div class="filter-section">' . '<label class="affiliate-id-filter">' . __( 'Id', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-id-filter" name="affiliate_id" type="text" value="' . esc_attr( $affiliate_id ) . '"/>' . '</label>' . ' ' . '<label class="affiliate-name-filter">' . __( 'Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-name-filter" name="affiliate_name" type="text" value="' . $affiliate_name . '"/>' . '</label>' . ' ' . '<label class="affiliate-email-filter">' . __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-email-filter" name="affiliate_email" type="text" value="' . $affiliate_email . '"/>' . '</label>' . ' ' . '<label class="affiliate-user-login-filter">' . __( 'Username', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-user-login-filter" name="affiliate_user_login" type="text" value="' . $affiliate_user_login . '" />' . '</label>' . '</div>' . '<div class="filter-section">' . '<label class="from-date-filter">' . __( 'From', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="datefield from-date-filter" name="from_date" type="text" value="' . esc_attr( $IXAP15 ) . '"/>'. '</label>' . ' ' . '<label class="thru-date-filter">' . __( 'Until', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="datefield thru-date-filter" name="thru_date" type="text" class="datefield" value="' . esc_attr( $IXAP16 ) . '"/>'. '</label>' . ' ' . '<label class="show-inoperative-filter">' . '<input class="show-inoperative-filter" name="show_inoperative" type="checkbox" ' . ( $show_inoperative ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include inoperative affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-active-filter">' . '<input class="show-active-filter" name="show_active" type="checkbox" ' . ( $show_active ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include active affiliates', AFFILIATES_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-pending-filter">' . '<input class="show-pending-filter" name="show_pending" type="checkbox" ' . ( $show_pending ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include pending affiliates', AFFILIATES_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-deleted-filter">' . '<input class="show-deleted-filter" name="show_deleted" type="checkbox" ' . ( $show_deleted ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include removed affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-totals-filter">' . '<input class="show-totals-filter" name="show_totals" type="checkbox" ' . ( $show_totals ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Show accumulated referral totals', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '</div>'; $IXAP34 .= '<div class="filter-buttons">' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE, true, false ) . '<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input class="button" type="submit" name="clear_filters" value="' . __( 'Clear', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>'; $IXAP34 .= '</form>'; $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; $IXAP34 .= sprintf( '<div id="columns-container" class="filters" style="%s">', $show_columns ? '' : 'display:none' ); $IXAP34 .= '<div>'; $IXAP34 .= __( 'Columns', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</div>'; $IXAP34 .= '<div id="column-toggles" class="column-toggles">'; foreach( $IXAP105 as $key => $IXAP161 ) { $normalized_key = preg_replace( '/(\.|\-)/', '_', $key ); $IXAP34 .= '<div class="column-toggle-container">'; $IXAP34 .= '<label>'; $IXAP34 .= sprintf( '<input class="column-toggle" type="checkbox" name="column-toggle-%s" id="column-toggle-%s" value="%s" %s />', esc_attr( $normalized_key ), esc_attr( $normalized_key ), esc_attr( $normalized_key ), isset( $affiliates_overview_columns[$normalized_key] ) && $affiliates_overview_columns[$normalized_key] ? ' checked="checked" ' : '' ); $IXAP34 .= $IXAP161; $IXAP34 .= '</label>'; $IXAP34 .= '</div>'; } $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; $IXAP34 .= '
			<div class="page-options right">
				<form id="setrowcount" action="" method="post">
					<div>
						<label for="row_count">' . __( 'Results per page', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input name="row_count" type="text" size="2" value="' . esc_attr( $IXAP247 ) .'" />
						' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_1, true, false ) . '
						<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>
					</div>
				</form>
			</div>
			'; if ( $IXAP252 ) { $IXAP253 = new Affiliates_Pagination($IXAP251, null, $IXAP247); $IXAP34 .= '<form id="posts-filter" method="post" action="">'; $IXAP34 .= '<div>'; $IXAP34 .= wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_2, true, false ); $IXAP34 .= '</div>'; $IXAP34 .= '<div class="tablenav top">'; $IXAP34 .= $IXAP253->pagination( 'top' ); $IXAP34 .= '</div>'; $IXAP34 .= '</form>'; } $IXAP34 .= '<form id="affiliates-action" method="post" action="">'; $IXAP34 .= wp_nonce_field( 'admin', AFFILIATES_ADMIN_AFFILIATES_ACTION_NONCE, true, false ); $IXAP34 .= '<div class="affiliates-bulk-container">'; $IXAP34 .= '<select class="bulk-action" name="bulk-action">'; $IXAP34 .= '<option selected="selected" value="-1">' . esc_html( __( 'Bulk Actions', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) . '</option>'; $IXAP34 .= '<option value="remove-affiliate">' . esc_html( __( 'Remove affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) . '</option>'; $IXAP34 .= '<option value="status-pending">' . esc_html( __( 'Set status to Pending', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) . '</option>'; $IXAP34 .= '<option value="status-active">' . esc_html( __( 'Set status to Active', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) . '</option>'; $IXAP34 .= '</select>'; $IXAP34 .= sprintf( '<input class="button" type="submit" name="bulk" value="%s" />', esc_attr( __( 'Apply', 'affiliates' ) ) ); $IXAP34 .= '<input type="hidden" name="action" value="affiliate-action"/>'; $IXAP34 .= '</div>'; $IXAP34 .= '<table id="affiliates-overview-table" class="wp-list-table widefat fixed" cellspacing="0">'; $IXAP34 .= '<thead>'; $IXAP34 .= '<tr>'; $IXAP34 .= '<th id="cb" class="manage-column column-cb check-column" scope="col"><input type="checkbox"></th>'; foreach ( $IXAP105 as $key => $IXAP106 ) { $key = preg_replace( '/(\.|\-)/', '_', $key ); $IXAP24 = array( 'orderby' => $key, 'order' => $switch_order ); $IXAP107 = $key; if ( in_array( $key, array( 'affiliate_id', 'name', 'email', 'user_login', 'from_date', 'thru_date', 'status' ) ) ) { if ( strcmp( $key, $IXAP68 ) == 0 ) { $IXAP108 = strtolower( $IXAP69 ); $IXAP107 = "$key manage-column sorted $IXAP108"; } else { $IXAP107 = "$key manage-column sortable"; } $IXAP106 = '<a href="' . esc_url( add_query_arg( $IXAP24, $IXAP59 ) ) . '"><span>' . $IXAP106 . '</span><span class="sorting-indicator"></span></a>'; } $IXAP34 .= sprintf( '<th scope="col" class="%s" style="%s">%s</th>', esc_attr( $IXAP107 ), isset( $affiliates_overview_columns[$key] ) && $affiliates_overview_columns[$key] ? '' : 'display:none', $IXAP106 ); } $IXAP34 .= '</tr>'; $IXAP34 .= '</thead>'; $IXAP34 .= '<tbody>'; if ( count( $IXAP26 ) > 0 ) { for ( $i = 0; $i < count( $IXAP26 ); $i++ ) { $IXAP11 = $IXAP26[$i]; $name_suffix = ''; $IXAP279 = ''; if ( $is_deleted = ( strcmp( $IXAP11->status, 'deleted' ) == 0 ) ) { $IXAP279 = ' deleted '; $name_suffix .= " " . __( '(removed)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } else if ( strcmp( $IXAP11->status, 'pending' ) == 0 ) { $IXAP279 .= ' pending '; } $IXAP113 = ''; if ( $is_inoperative = ! ( ( $IXAP11->from_date <= $IXAP83 ) && ( $IXAP11->thru_date == null || $IXAP11->thru_date >= $IXAP83 ) ) ) { $IXAP113 = ' inoperative '; $name_suffix .= " " . __( '(inoperative)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } $IXAP34 .= '<tr class="' . $IXAP279 . $IXAP113 . ( $i % 2 == 0 ? 'even' : 'odd' ) . '">'; $IXAP34 .= '<th class="check-column">'; $IXAP34 .= '<input type="checkbox" value="' . esc_attr( $IXAP11->affiliate_id ) . '" name="affiliate_ids[]"/>'; $IXAP34 .= '</th>'; $IXAP34 .= sprintf( '<td class="affiliate_id" style="%s">', isset( $affiliates_overview_columns['affiliate_id'] ) && $affiliates_overview_columns['affiliate_id'] ? '' : 'display:none' ); if ( affiliates_encode_affiliate_id( $IXAP11->affiliate_id ) != $IXAP11->affiliate_id ) { $IXAP34 .= '<span class="encoded-hint" title="' . affiliates_encode_affiliate_id( $IXAP11->affiliate_id ) . '">' . $IXAP11->affiliate_id . '</span>'; } else { $IXAP34 .= $IXAP11->affiliate_id; } $IXAP34 .= '</td>'; $IXAP280 = remove_query_arg( array( 'paged', 'action', 'affiliate_id' ), $IXAP59 ); $IXAP280 = add_query_arg( array( 'paged' => $IXAP249, 'action' => 'edit', 'affiliate_id' => $IXAP11->affiliate_id ), $IXAP59 ); $IXAP34 .= sprintf( '<td class="name affiliate-name" style="%s">', isset( $affiliates_overview_columns['name'] ) && $affiliates_overview_columns['name'] ? '' : 'display:none' ); $IXAP34 .= '<div>'; $IXAP34 .= sprintf( '<a href="%s">%s</a>', esc_url( $IXAP280 ), stripslashes( wp_filter_nohtml_kses( $IXAP11->name ) ) . $name_suffix ); $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= sprintf( '<a class="edit" href="%s">%s</a>', esc_url( $IXAP280 ), __( 'Edit', AFFILIATES_PRO_PLUGIN_DOMAIN ), __( 'Edit', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); if ( !$is_deleted && ( !isset( $IXAP11->type ) || ( $IXAP11->type != AFFILIATES_DIRECT_TYPE ) ) ) { $IXAP281 = remove_query_arg( array( 'paged', 'action', 'affiliate_id' ), $IXAP59 ); $IXAP281 = add_query_arg( array( 'paged' => $IXAP249, 'action' => 'remove', 'affiliate_id' => $IXAP11->affiliate_id ), $IXAP59 ); $IXAP34 .= ' '; $IXAP34 .= sprintf( '<a class="remove" href="%s">%s</a>', esc_url( $IXAP281 ), __( 'Remove', AFFILIATES_PRO_PLUGIN_DOMAIN ), __( 'Remove', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } $IXAP34 .= '</div>'; $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="email affiliate-email" style="%s">', isset( $affiliates_overview_columns['email'] ) && $affiliates_overview_columns['email'] ? '' : 'display:none' ); $IXAP34 .= $IXAP11->email; if ( isset( $IXAP11->email ) && isset( $IXAP11->user_email ) && strcmp( $IXAP11->email, $IXAP11->user_email ) !== 0 ) { $IXAP34 .= '<span title="' . sprintf( __( 'There are different email addresses on record for the affiliate and the associated user. This might be ok, but if in doubt please check. The email address on file for the user is %s', AFFILIATES_PRO_PLUGIN_DOMAIN ), $IXAP11->user_email ) . '" class="warning"> [&nbsp;!&nbsp]</span>'; } $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="user_login affiliate-user-login" style="%s">', isset( $affiliates_overview_columns['user_login'] ) && $affiliates_overview_columns['user_login'] ? '' : 'display:none' ); if ( !empty( $IXAP11->ID ) ) { if ( current_user_can( 'edit_user', $IXAP11->ID ) ) { $IXAP34 .= '<a target="_blank" href="' . esc_url( "user-edit.php?user_id=$IXAP11->ID" ) . '">' . $IXAP11->user_login . '</a>'; } else { $IXAP34 .= $IXAP11->user_login; } } $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="from_date from-date" style="%s">', isset( $affiliates_overview_columns['from_date'] ) && $affiliates_overview_columns['from_date'] ? '' : 'display:none' ); $IXAP34 .= $IXAP11->from_date; $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="thru_date thru-date" style="%s">', isset( $affiliates_overview_columns['thru_date'] ) && $affiliates_overview_columns['thru_date'] ? '' : 'display:none' ); $IXAP34 .= $IXAP11->thru_date; $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="status" style="%s">', isset( $affiliates_overview_columns['status'] ) && $affiliates_overview_columns['status'] ? '' : 'display:none' ); $IXAP34 .= $IXAP11->status; $IXAP34 .= '</td>'; $IXAP34 .= sprintf( '<td class="links" style="%s">', isset( $affiliates_overview_columns['links'] ) && $affiliates_overview_columns['links'] ? '' : 'display:none' ); $IXAP193 = affiliates_encode_affiliate_id( $IXAP11->affiliate_id ); $IXAP34 .= __( 'Link', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ': ' . '<span class="affiliate-link">' . Affiliates_Url_Renderer::get_affiliate_url( get_bloginfo( 'url' ), $IXAP11->affiliate_id ) . '</span>' . '<br/>' . __( 'URL Parameter', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ': ' . '<span class="affiliate-link-param">' . '?' . $IXAP5 . '=' . $IXAP193 . '</span>'; $IXAP34 .= '</td>'; foreach( Affiliates_Attributes::get_keys() as $IXAP201 => $IXAP202 ) { $IXAP203 = $IXAP201; $IXAP201 = preg_replace( '/(\.|\-)/', '_', $IXAP201 ); $style = isset( $affiliates_overview_columns[$IXAP201] ) && $affiliates_overview_columns[$IXAP201] ? '' : 'display:none'; $IXAP204 = $affiliates_db->get_value( "SELECT attr_value FROM $affiliates_attributes_table WHERE affiliate_id = %d AND attr_key = %s", $IXAP11->affiliate_id, $IXAP203 ); $IXAP34 .= sprintf( '<td class="%s" style="%s">', $IXAP201, $style ); $IXAP34 .= wp_filter_nohtml_kses( $IXAP204 ); $IXAP34 .= '</td>'; } foreach( $registration_fields as $name => $field ) { if ( $field['enabled'] ) { $type = isset( $field['type'] ) ? $field['type'] : 'text'; $value = ''; switch( $name ) { case 'user_login' : $value = $user->user_login; break; case 'user_email' : $value = $user->user_email; break; case 'user_url' : $value = $user->user_url; break; case 'password' : $value = ''; break; default : $value = get_user_meta( $IXAP11->ID, $name , true ); } $style = isset( $affiliates_overview_columns[$name] ) && $affiliates_overview_columns[$name] ? '' : 'display:none'; $IXAP34 .= sprintf( '<td class="%s" style="%s">', $name, $style ); $IXAP34 .= stripslashes( wp_filter_nohtml_kses( $value ) ); $IXAP34 .= '</td>'; } } $IXAP34 .= '</tr>'; if ( $show_totals ) { $IXAP34 .= '<tr class="' . $IXAP279 . $IXAP113 . ( $i % 2 == 0 ? 'even' : 'odd' ) . '">'; $IXAP22 = array(); $IXAP22[AFFILIATES_REFERRAL_STATUS_CLOSED] = Affiliates_Shortcodes::get_total( $IXAP11->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_CLOSED ); $IXAP22[AFFILIATES_REFERRAL_STATUS_ACCEPTED] = Affiliates_Shortcodes::get_total( $IXAP11->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_ACCEPTED ); $IXAP22[AFFILIATES_REFERRAL_STATUS_PENDING] = Affiliates_Shortcodes::get_total( $IXAP11->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_PENDING ); $IXAP22[AFFILIATES_REFERRAL_STATUS_REJECTED] = Affiliates_Shortcodes::get_total( $IXAP11->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_REJECTED ); $IXAP34 .= '<td class="dynamic-colspan" colspan="' . $IXAP277 . '">'; $IXAP34 .= '<table class="affiliate-referral-totals">'; $IXAP34 .= '<thead>'; $IXAP34 .= '<tr>'; foreach( $IXAP22 as $status => $IXAP23 ) { if ( $IXAP23 ) { $IXAP34 .= '<th>'; $IXAP34 .= '<strong>'; switch( $status ) { case AFFILIATES_REFERRAL_STATUS_CLOSED : $IXAP34 .= sprintf( __( '<span style="cursor:help" title="%s">Closed</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for closed referrals (commissions paid).', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_ACCEPTED : $IXAP34 .= sprintf( __( '<span style="cursor:help" title="%s">Accepted</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for accepted referrals (commissions unpaid).', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_PENDING : $IXAP34 .= sprintf( __( '<span style="cursor:help" title="%s">Pending</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for pending referrals.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_REJECTED : $IXAP34 .= sprintf( __( '<span style="cursor:help" title="%s">Rejected</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for rejected referrals.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; } $IXAP34 .= '</strong>'; $IXAP34 .= '</th>'; } } $IXAP34 .= '</thead>'; $IXAP34 .= '</tr>'; $IXAP34 .= '<tbody>'; $IXAP34 .= '<tr>'; foreach( $IXAP22 as $status => $IXAP23 ) { if ( $IXAP23 ) { $IXAP34 .= '<td>'; $IXAP34 .= '<ul>'; foreach( $IXAP23 as $IXAP45 => $amount ) { $IXAP34 .= '<li>'; $IXAP34 .= sprintf( __( '%1$s %2$s', AFFILIATES_PRO_PLUGIN_DOMAIN ), $IXAP45, $amount ); $IXAP34 .= '</li>'; } $IXAP34 .= '</ul>'; $IXAP34 .= '</td>'; } } $IXAP34 .= '</tr>'; $IXAP34 .= '<tbody>'; $IXAP34 .= '</table>'; $IXAP34 .= '</td>'; $IXAP34 .= '</tr>'; } } } else { $IXAP34 .= '<tr><td class="dynamic-colspan" colspan="' . $IXAP277 . '">' . __('There are no results.', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</td></tr>'; } $IXAP34 .= '</tbody>'; $IXAP34 .= '</table>'; if ( $IXAP252 ) { $IXAP253 = new Affiliates_Pagination( $IXAP251, null, $IXAP247 ); $IXAP34 .= '<div class="tablenav bottom">'; $IXAP34 .= $IXAP253->pagination( 'bottom' ); $IXAP34 .= '</div>'; } $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; echo $IXAP34; affiliates_footer(); } } 