<?php
 class Affiliates_Banner { public static function init() { add_action( 'init', array( __CLASS__, 'wp_init' ), 11 ); add_action( 'admin_init', array(__CLASS__, 'admin_init' ) ); add_shortcode( 'affiliates_banner', array( __CLASS__, 'affiliates_banner_shortcode' ) ); add_filter( 'media_view_strings', array( __CLASS__, 'media_view_strings' ), 10, 2 ); add_filter( 'upload_dir', array(__CLASS__,'upload_dir' ) ); } public static function admin_init() { global $pagenow; add_action( 'add_meta_boxes', array( __CLASS__, 'add_meta_boxes' ), 10, 2 ); add_filter( 'enter_title_here', array( __CLASS__, 'enter_title_here' ), 10, 2 ); add_action( 'edit_form_after_title', array( __CLASS__, 'edit_form_after_title' ) ); add_action( 'save_post', array( __CLASS__, 'save_post' ), 10, 2 ); add_filter( 'post_row_actions', array( __CLASS__, 'post_row_actions' ) ); add_filter( 'post_updated_messages', array( __CLASS__, 'post_updated_messages' ) ); add_filter( 'manage_affiliates_banner_posts_columns', array( __CLASS__, 'posts_columns' ) ); add_filter( 'manage_edit-affiliates_banner_columns', array( __CLASS__, 'edit_affiliates_banner_columns' ) ); add_filter( 'manage_affiliates_banner_posts_custom_column', array( __CLASS__, 'posts_custom_column' ), 10, 2 ); add_action( 'current_screen', array(__CLASS__, 'current_screen' ) ); add_filter( 'parent_file', array( __CLASS__, 'parent_file' ) ); $screen_id = isset( $_REQUEST['screen_id'] ) ? $_REQUEST['screen_id'] : ''; $action = isset( $_REQUEST['action'] ) ? $_REQUEST['action'] : ''; if ( isset( $pagenow ) && ( $pagenow == 'admin-ajax.php' ) && ( ( $screen_id == 'affiliates_banner' ) || ( $action == 'set-post-thumbnail' ) ) ) { if ( !has_filter( 'gettext', array( __CLASS__, 'gettext' ) ) ) { add_filter( 'gettext', array( __CLASS__, 'gettext' ), 10, 3 ); } } } public static function current_screen() { $screen = get_current_screen(); if ( isset( $screen->id ) ) { switch( $screen->id ) { case 'edit-affiliates_banner' : case 'affiliates_banner' : if ( !has_filter( 'gettext', array( __CLASS__, 'gettext' ) ) ) { add_filter( 'gettext', array( __CLASS__, 'gettext' ), 10, 3 ); } break; } } } public static function parent_file( $parent_file ) { global $submenu_file; switch ( $submenu_file ) { case 'post-new.php?post_type=affiliates_banner' : case 'edit.php?post_type=affiliates_banner' : $parent_file = 'affiliates-admin'; $submenu_file = 'edit.php?post_type=affiliates_banner'; break; } return $parent_file; } public static function media_view_strings( $strings, $post ) { if ( isset( $post->post_type ) && ( $post->post_type == 'affiliates_banner' ) ) { $strings['setFeaturedImageTitle'] = __( 'Set Banner Image', AFFILIATES_PRO_PLUGIN_DOMAIN ); $strings['setFeaturedImage'] = __( 'Set banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ); } return $strings; } public static function gettext( $IXAP297, $IXAP298, $IXAP299 ) { remove_filter( 'gettext', array( __CLASS__, 'gettext' ) ); switch( $IXAP298 ) { case '(no title)' : $IXAP297 = __( '(no reference)', AFFILIATES_PRO_PLUGIN_DOMAIN ); break; case 'Set featured image' : $IXAP297 = __( 'Set banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ); break; case 'Remove featured image' : $IXAP297 = __( 'Remove banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ); break; } add_filter( 'gettext', array( __CLASS__, 'gettext'), 10, 3 ); return $IXAP297; } public static function posts_columns( $posts_columns ) { foreach( $posts_columns as $key => $value ) { switch( $key ) { case 'title' : $posts_columns[$key] = __( 'Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ); break; } } return $posts_columns; } public static function edit_affiliates_banner_columns( $IXAP62 ) { if ( isset( $IXAP62['date'] ) ) { $IXAP160 = $IXAP62['date']; unset( $IXAP62['date'] ); } $IXAP62['image'] = __( 'Image', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP62['shortcode'] = __( 'Shortcode', AFFILIATES_PRO_PLUGIN_DOMAIN ); if ( isset( $IXAP160 ) ) { $IXAP62['date'] = $IXAP160; } return $IXAP62; } public static function posts_custom_column( $IXAP58, $post_id ) { global $affiliates_banner_admin_style_flag; if ( !isset( $affiliates_banner_admin_style_flag ) ) { $affiliates_banner_admin_style_flag = true; echo '<style type="text/css">'; echo 'th.column-title { width: 15%; }'; echo 'td.image.column-image { overflow: hidden; }'; echo '</style>'; } switch( $IXAP58 ) { case 'image' : $IXAP300 = get_the_post_thumbnail( $post_id ); if ( empty( $IXAP300 ) ) { $IXAP300 = self::get_url_thumbnail( $post_id ); } printf( '<a href="%s">%s</a>', esc_attr( get_edit_post_link( $post_id ) ), $IXAP300 ); break; case 'shortcode' : echo '<p>'; printf( __( '<code>[affiliates_banner id="%d"]</code>', AFFILIATES_PRO_PLUGIN_DOMAIN ), $post_id ); echo '</p>'; break; } } public static function get_url_thumbnail( $post_id ) { $IXAP30 = get_post_meta( $post_id, 'url', true ); $IXAP301 = get_post_meta( $post_id, 'width', true ); $IXAP302 = get_post_meta( $post_id, 'height', true ); list( $IXAP301, $IXAP302 ) = image_constrain_size_for_editor( $IXAP301, $IXAP302, $size = 'thumbnail' ); $IXAP300 = sprintf( '<img src="%s" width="%d" height="%d" />', $IXAP30, $IXAP301, $IXAP302 ); return $IXAP300; } public static function get_url_image( $post_id, $IXAP303 ) { $IXAP30 = get_post_meta( $post_id, 'url', true ); $IXAP301 = get_post_meta( $post_id, 'width', true ); $IXAP302 = get_post_meta( $post_id, 'height', true ); $image = sprintf( '<img src="%s" width="%d" height="%d" alt="%s" />', $IXAP30, intval( $IXAP301 ), intval( $IXAP302 ), esc_attr( $IXAP303 ) ); return $image; } public static function wp_init() { self::post_type(); } public static function post_type() { register_post_type( 'affiliates_banner', array( 'labels' => array( 'name' => __( 'Banners', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'singular_name' => __( 'Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'all_items' => __( 'Banners', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'add_new' => __( 'New Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'add_new_item' => __( 'Add New Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'edit' => __( 'Edit', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'edit_item' => __( 'Edit Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'new_item' => __( 'New Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'not_found' => __( 'No Banners found', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'not_found_in_trash' => __( 'No Banners found in trash', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'parent' => __( 'Parent Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'search_items' => __( 'Search Banners', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'view' => __( 'View Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'view_item' => __( 'View Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'menu_name' => __( 'Banners', AFFILIATES_PRO_PLUGIN_DOMAIN ) ), 'capability_type' => array( 'affiliates_banner', 'affiliates_banners' ), 'description' => __( 'Affiliate Banner', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'exclude_from_search' => true, 'has_archive' => false, 'hierarchical' => false, 'map_meta_cap' => true, 'public' => false, 'publicly_queryable' => false, 'query_var' => true, 'rewrite' => false, 'show_in_nav_menus' => false, 'show_ui' => true, 'supports' => array( 'title', 'thumbnail' ), 'show_in_menu' => false, ) ); self::create_capabilities(); } public static function create_capabilities() { global $wp_roles; $IXAP304 = $wp_roles->get_role( 'administrator' ); $IXAP305 = self::get_capabilities(); foreach( $IXAP305 as $key => $IXAP306 ) { if ( !$IXAP304->has_cap( $IXAP306 ) ) { $IXAP304->add_cap( $IXAP306 ); } } } public static function get_capabilities() { return array( 'edit_posts' => 'edit_affiliates_banners', 'edit_others_posts' => 'edit_others_affiliates_banners', 'publish_posts' => 'publish_affiliates_banners', 'read_private_posts' => 'read_private_affiliates_banners', 'delete_posts' => 'delete_affiliates_banners', 'delete_private_posts' => 'delete_private_affiliates_banners', 'delete_published_posts' => 'delete_published_affiliates_banners', 'delete_others_posts' => 'delete_others_affiliates_banners', 'edit_private_posts' => 'edit_private_affiliates_banners', 'edit_published_posts' => 'edit_published_affiliates_banners', ); } public static function add_meta_boxes( $post_type, $post ) { if ( $post_type == 'affiliates_banner' ) { remove_meta_box( 'postimagediv', 'affiliates_banner', 'side' ); add_meta_box( 'postimagediv', __( 'Banner Image', AFFILIATES_PRO_PLUGIN_DOMAIN ), array( __CLASS__, 'post_thumbnail_meta_box' ), 'affiliates_banner', 'normal', 'high' ); add_meta_box( 'url', __( 'URL', AFFILIATES_PRO_PLUGIN_DOMAIN ), array( __CLASS__, 'url_meta_box' ), 'affiliates_banner', 'normal', 'high' ); } } public static function enter_title_here( $IXAP190, $post ) { if ( $post->post_type == 'affiliates_banner' ) { return __( 'Banner reference &hellip;', AFFILIATES_PRO_PLUGIN_DOMAIN ); } return $IXAP190; } public static function edit_form_after_title( $post ) { if ( isset( $post->post_type ) && $post->post_type == 'affiliates_banner' ) { echo '<div style="padding:2px 1em 1em 1em;" class="description">'; echo '<p>'; echo __( 'The reference for this banner (also used as <em>alt</em> attribute for images specified by URL).', AFFILIATES_PRO_PLUGIN_DOMAIN ); echo '</p>'; echo '<p>'; echo __( 'Set a banner image and determine its title and other attributes directly for the image attachment using the <strong>Banner Image</strong> facilities.', AFFILIATES_PRO_PLUGIN_DOMAIN ); echo '</p>'; if ( isset( $post->ID ) ) { echo '<p>'; printf( __( 'Use this shortcode to embed the banner: <code>[affiliates_banner id="%d"]</code>', AFFILIATES_PRO_PLUGIN_DOMAIN ), $post->ID ); echo '</p>'; } echo '</div>'; } } public static function url_meta_box( $post ) { $IXAP34 = ''; $IXAP30 = get_post_meta( $post->ID, 'url', true ); $IXAP301 = get_post_meta( $post->ID, 'width', true ); $IXAP302 = get_post_meta( $post->ID, 'height', true ); $IXAP307 = get_post_meta( $post->ID, 'update_size', true ); if ( empty( $IXAP307 ) ) { $IXAP307 = 'yes'; } $IXAP34 .= '<div>'; $IXAP34 .= '<p>'; $IXAP34 .= __( 'Alternatively, a banner image URL can be specified.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= __( 'This is useful if you want to use an external image or an image that is located outside the uploads directory structure.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= __( 'If a banner image is set, it takes precedence - this is only used if no banner image is set.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= self::get_url_thumbnail( $post->ID ); $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= '<label>'; $IXAP34 .= __( 'URL', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= sprintf( '<input style="display:block; width:100%%" type="text" name="url" value="%s" />', esc_attr( $IXAP30 ) ); $IXAP34 .= '</label>'; $IXAP34 .= '<p class="description">'; $IXAP34 .= __( 'Banner image URL.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= '<label>'; $IXAP34 .= sprintf( '<input type="checkbox" name="update_size" value="1" %s />', $IXAP307 == 'yes' ? ' checked="checked" ' : '' ); $IXAP34 .= ' '; $IXAP34 .= __( 'Update Size', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</label>'; $IXAP34 .= '<p class="description">'; $IXAP34 .= __( 'Try to obtain the image width and height based on the URL and update the values.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= '<label>'; $IXAP34 .= __( 'Width', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= sprintf( '<input style="display:block; width:5em" type="text" name="width" value="%s" />', esc_attr( $IXAP301 ) ); $IXAP34 .= '</label>'; $IXAP34 .= '<p class="description">'; $IXAP34 .= __( 'Banner image width in pixels.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; $IXAP34 .= '<div>'; $IXAP34 .= '<label>'; $IXAP34 .= __( 'Height', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= sprintf( '<input style="display:block; width:5em" type="text" name="height" value="%s" />', esc_attr( $IXAP302 ) ); $IXAP34 .= '</label>'; $IXAP34 .= '<p class="description">'; $IXAP34 .= __( 'Banner image height in pixels.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; echo $IXAP34; } public static function save_post( $post_id = null, $post = null ) { if ( ! ( ( defined( "DOING_AUTOSAVE" ) && DOING_AUTOSAVE ) ) ) { if ( $post->post_type == 'affiliates_banner' ) { if ( $post->post_status != 'auto-draft' ) { if ( isset( $_REQUEST['action'] ) && ( $_REQUEST['action'] == 'inline-save' ) ) { return; } $IXAP30 = !empty( $_POST['url'] ) ? trim( $_POST['url'] ) : ''; delete_post_meta( $post_id, 'url' ); if ( !empty( $IXAP30 ) ) { add_post_meta( $post_id, 'url', $IXAP30 ); } $IXAP307 = !empty( $_POST['update_size'] ) ? 'yes' : 'no'; delete_post_meta( $post_id, 'update_size' ); add_post_meta( $post_id, 'update_size', $IXAP307 ); $IXAP301 = null; $IXAP302 = null; if ( $IXAP307 == 'yes' ) { if ( !empty( $IXAP30 ) ) { if ( $size = getimagesize( $IXAP30 ) ) { if ( isset( $size[0] ) ) { $IXAP301 = $size[0]; } if ( isset( $size[1] ) ) { $IXAP302 = $size[1]; } } } } if ( $IXAP301 === null ) { $IXAP301 = !empty( $_POST['width'] ) ? intval( trim( $_POST['width'] ) ) : 0; } delete_post_meta( $post_id, 'width' ); if ( $IXAP301 > 0 ) { add_post_meta( $post_id, 'width', $IXAP301 ); } if ( $IXAP302 === null ) { $IXAP302 = !empty( $_POST['height'] ) ? intval( trim( $_POST['height'] ) ) : 0; } delete_post_meta( $post_id, 'height' ); if ( $IXAP302 > 0 ) { add_post_meta( $post_id, 'height', $IXAP302 ); } } } } } public static function post_row_actions( $actions ) { $post_type = get_post_type(); if ( $post_type == 'affiliates_banner' ) { unset( $actions['view'] ); } return $actions; } public static function post_updated_messages( $messages ) { $post = get_post(); $messages['affiliates_banner'] = array( 0 => '', 1 => __( 'Banner updated.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 2 => __( 'Custom field updated.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 3 => __( 'Custom field deleted.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 4 => __( 'Banner updated.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 5 => isset( $_GET['revision'] ) ? sprintf( __( 'Banner restored to revision from %s', AFFILIATES_PRO_PLUGIN_DOMAIN ), wp_post_revision_title( ( int ) $_GET['revision'], false ) ) : false, 6 => __( 'Banner published.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 7 => __( 'Banner saved.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 8 => __( 'Banner submitted.', AFFILIATES_PRO_PLUGIN_DOMAIN ), 9 => sprintf( __( 'Banner scheduled for: <strong>%1$s</strong>.', AFFILIATES_PRO_PLUGIN_DOMAIN ), date_i18n( __( 'M j, Y @ G:i' ), strtotime( $post->post_date ) ) ), 10 => __( 'Banner draft updated.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); return $messages; } public static function affiliates_banner_shortcode( $IXAP31, $IXAP32 = '' ) { $IXAP24 = shortcode_atts( array( 'id' => '*', 'url' => '', 'render' => '' ), $IXAP31 ); $IXAP34 = ''; $IXAP30 = trim( $IXAP24['url'] ); $id = trim( $IXAP24['id'] ); $IXAP138 = trim( $IXAP24['render'] ); $IXAP308 = array_map( 'trim', explode( ',', $IXAP30 ) ); $post_ids = array(); if ( trim( $id ) == '*' ) { $posts = get_posts( array( 'numberposts' => -1, 'post_type' => 'affiliates_banner', 'post_status' => 'publish' ) ); foreach( $posts as $post ) { if ( get_post_thumbnail_id( $post->ID ) || get_post_meta( $post->ID, 'url', true ) ) { $post_ids[] = $post->ID; } } } else { $post_ids = array_map( 'intval', array_map( 'trim', explode( ',', $id ) ) ); } $IXAP309 = array(); $i = 0; foreach( $post_ids as $post_id ) { if ( isset( $IXAP308[$i] ) ) { if ( !empty( $IXAP308[$i] ) ) { $IXAP309['url'] = $IXAP308[$i]; } } $IXAP30 = Affiliates_Url_Renderer_WordPress::render_affiliate_url( $IXAP309 ); add_filter( 'wp_get_attachment_image_attributes', array( __CLASS__, 'wp_get_attachment_image_attributes' ), 999, 2 ); $image = get_the_post_thumbnail( $post_id, 'full', array( 'class' => '' ) ); if ( empty( $image ) ) { $IXAP303 = get_the_title( $post_id ); $image = self::get_url_image( $post_id, $IXAP303 ); } $IXAP310 = sprintf( '<a href="%s">%s</a>', esc_attr( $IXAP30 ), $image ); remove_filter( 'wp_get_attachment_image_attributes', array( __CLASS__, 'wp_get_attachment_image_attributes' ) ); $IXAP34 .= apply_filters( 'affiliates_banner_before', '', $IXAP31 ); $IXAP34 .= '<div class="affiliates-banner">'; if ( empty( $IXAP138 ) || ( $IXAP138 == 'image' ) ) { $IXAP34 .= apply_filters( 'affiliates_banner_image_before', '', $id, $IXAP30, $IXAP31 ); $IXAP34 .= apply_filters( 'affiliates_banner_image', '<div class="banner-image">' . $image . '</div>', $id, $IXAP30, $IXAP31 ); $IXAP34 .= apply_filters( 'affiliates_banner_image_after', '', $id, $IXAP30, $IXAP31 ); } if ( empty( $IXAP138 ) || ( $IXAP138 == 'code' ) ) { $IXAP34 .= apply_filters( 'affiliates_banner_code_before', '', $id, $IXAP30, $IXAP31 ); $IXAP34 .= apply_filters( 'affiliates_banner_code', '<div class="banner-code">' . '<code>' . htmlentities( $IXAP310 ) . '</code>' . '</div>', $id, $IXAP30, $IXAP31 ); $IXAP34 .= apply_filters( 'affiliates_banner_code_after', '', $id, $IXAP30, $IXAP31 ); } $IXAP34 .= '</div>'; $IXAP34 .= apply_filters( 'affiliates_banner_after', '', $IXAP31 ); $i++; } $IXAP34 = apply_filters( 'affiliates_banner', $IXAP34, $IXAP31 ); return $IXAP34; } public static function wp_get_attachment_image_attributes( $IXAP242, $IXAP311 ) { unset( $IXAP242['class'] ); return $IXAP242; } public static function post_thumbnail_meta_box( $post ) { $IXAP312 = get_post_meta( $post->ID, '_thumbnail_id', true ); echo self::_wp_post_thumbnail_html( $IXAP312, $post->ID ); } public static function _wp_post_thumbnail_html( $IXAP312 = null, $post = null ) { global $IXAP313, $IXAP314; $post = get_post( $post ); $IXAP315 = esc_url( get_upload_iframe_src('image', $post->ID ) ); $set_thumbnail_link = '<p class="hide-if-no-js"><a title="' . esc_attr__( 'Set banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '" href="%s" id="set-post-thumbnail" class="thickbox">%s</a></p>'; $IXAP32 = sprintf( $set_thumbnail_link, $IXAP315, esc_html__( 'Set banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); if ( $IXAP312 && get_post( $IXAP312 ) ) { $IXAP316 = $IXAP313; $IXAP313 = 266; if ( !isset( $IXAP314['full'] ) ) { $IXAP317 = wp_get_attachment_image( $IXAP312, array( $IXAP313, $IXAP313 ) ); } else { $IXAP317 = wp_get_attachment_image( $IXAP312, 'full' ); } if ( !empty( $IXAP317 ) ) { $IXAP318 = wp_create_nonce( 'set_post_thumbnail-' . $post->ID ); $IXAP32 = sprintf( $set_thumbnail_link, $IXAP315, $IXAP317 ); $IXAP32 .= '<p class="hide-if-no-js"><a href="#" id="remove-post-thumbnail" onclick="WPRemoveThumbnail(\'' . $IXAP318 . '\');return false;">' . esc_html__( 'Remove banner image', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</a></p>'; } $IXAP313 = $IXAP316; } return apply_filters( 'admin_post_thumbnail_html', $IXAP32, $post->ID ); } public static function upload_dir( $params ) { global $post, $post_id; if ( empty( $post_id ) ) { if ( !empty( $post ) && isset( $post->ID ) ) { $post_id = $post->ID; } else { $post_id = !empty( $_REQUEST['post_id'] ) ? intval( $_REQUEST['post_id'] ) : null; } } if ( !empty( $post_id ) && ( get_post_type( $post_id ) == 'affiliates_banner' ) ) { if ( apply_filters( 'affiliates_banner_empty_subdir', true ) ) { $params['subdir'] = ''; $params['path'] = $params['basedir'] . '/banners'; $params['url'] = $params['baseurl'] . '/banners'; } else { if ( empty( $params['subdir'] ) ) { $params['path'] = $params['path'] . '/banners'; $params['url'] = $params['url'] . '/banners'; $params['subdir'] = '/banners'; } else { $subdir = '/banners' . $params['subdir']; $params['path'] = str_replace( $params['subdir'], $subdir, $params['path'] ); $params['url'] = str_replace( $params['subdir'], $subdir, $params['url'] ); $params['subdir'] = str_replace( $params['subdir'], $subdir, $params['subdir'] ); } } } return $params; } } Affiliates_Banner::init(); 