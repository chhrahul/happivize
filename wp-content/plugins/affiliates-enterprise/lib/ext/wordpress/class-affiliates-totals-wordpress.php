<?php
class Affiliates_Totals_WordPress extends Affiliates_Totals { const NONCE = 'totals-nonce'; const NONCE_1 = 'totals-nonce-1'; const NONCE_2 = 'totals-nonce-2'; const SET_FILTERS = 'set-filters'; const SET_RPP = 'set-rpp'; const SET_PAGE = 'set-page'; const NONCE_MP = 'totals-nonce-mp'; const IXAP332 = 'gen-mp-pp'; const IXAP333 = 10; public static function view() { global $wpdb, $wp_rewrite, $affiliates_options; global $affiliates_db; $IXAP34 = ''; $IXAP83 = date( 'Y-m-d', time() ); if ( !current_user_can( AFFILIATES_ACCESS_AFFILIATES ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } if ( isset( $_POST['action'] ) ) { switch( $_POST['action'] ) { case 'do_foo' : break; } } else if ( isset ( $_GET['action'] ) ) { switch( $_GET['action'] ) { case 'close_referrals' : $params = array( 'tables' => array( 'referrals' => $affiliates_db->get_tablename( 'referrals' ), 'affiliates' => $affiliates_db->get_tablename( 'affiliates' ), 'affiliates_users' => $affiliates_db->get_tablename( 'affiliates_users' ), 'users' => $wpdb->users, ) ); $params = array_merge( $_GET, $params ); echo self::update_status( AFFILIATES_REFERRAL_STATUS_CLOSED, $params ); die(); break; } } if ( isset( $_POST['from_date'] ) || isset( $_POST['thru_date'] ) || isset( $_POST['minimum_total'] ) || isset( $_POST['affiliate_status'] ) || isset( $_POST['referral_status'] ) || isset( $_POST['currency_id'] ) || isset( $_POST['clear_filters'] ) || isset( $_POST['affiliate_id'] ) || isset( $_POST['affiliate_name'] ) || isset( $_POST['affiliate_user_login'] ) || isset( $_POST['show_deleted'] ) || isset( $_POST['show_inoperative'] ) ) { if ( !wp_verify_nonce( $_POST[self::NONCE], self::SET_FILTERS ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP15 = $affiliates_options->get_option( 'totals_from_date', null ); $IXAP20 = null; $IXAP16 = $affiliates_options->get_option( 'totals_thru_date', null ); $IXAP21 = null; $IXAP178 = $affiliates_options->get_option( 'totals_minimum_total', null ); $affiliate_status = $affiliates_options->get_option( 'totals_affiliate_status', null ); $referral_status = $affiliates_options->get_option( 'totals_referral_status', null ); $currency_id = $affiliates_options->get_option( 'totals_currency_id', null ); $affiliate_id = $affiliates_options->get_option( 'totals_affiliate_id', null ); $affiliate_name = $affiliates_options->get_option( 'totals_affiliate_name', null ); $affiliate_user_login = $affiliates_options->get_option( 'totals_affiliate_user_login', null ); $show_deleted = $affiliates_options->get_option( 'totals_show_deleted', false ); $show_inoperative = $affiliates_options->get_option( 'totals_show_inoperative', false ); if ( isset( $_POST['clear_filters'] ) ) { $affiliates_options->delete_option( 'totals_from_date' ); $affiliates_options->delete_option( 'totals_thru_date' ); $affiliates_options->delete_option( 'totals_minimum_total' ); $affiliates_options->delete_option( 'totals_affiliate_status' ); $affiliates_options->delete_option( 'totals_referral_status' ); $affiliates_options->delete_option( 'totals_currency_id' ); $affiliates_options->delete_option( 'totals_affiliate_id' ); $affiliates_options->delete_option( 'totals_affiliate_name' ); $affiliates_options->delete_option( 'totals_affiliate_user_login' ); $affiliates_options->delete_option( 'totals_show_deleted' ); $affiliates_options->delete_option( 'totals_show_inoperative' ); $IXAP15 = null; $IXAP20 = null; $IXAP16 = null; $IXAP21 = null; $IXAP178 = null; $affiliate_status = null; $referral_status = null; $currency_id = null; $affiliate_id = null; $affiliate_name = null; $affiliate_user_login = null; $show_deleted = false; $show_inoperative = false; } else if ( isset( $_POST['submitted'] ) ) { if ( !empty( $_POST['minimum_total'] ) ) { $IXAP178 = bcadd( "0", $_POST['minimum_total'], AFFILIATES_REFERRAL_AMOUNT_DECIMALS ); $affiliates_options->update_option( 'totals_minimum_total', $IXAP178 ); } else { $IXAP178 = null; $affiliates_options->delete_option( 'totals_minimum_total' ); } if ( !empty( $_POST['affiliate_status'] ) && ( $affiliate_status = Affiliates_Utility::verify_affiliate_status( $_POST['affiliate_status'] ) ) ) { $affiliates_options->update_option( 'totals_affiliate_status', $affiliate_status ); } else { $affiliate_status = null; $affiliates_options->delete_option( 'totals_affiliate_status' ); } if ( !empty( $_POST['referral_status'] ) && ( $referral_status = Affiliates_Utility::verify_referral_status_transition( $_POST['referral_status'], $_POST['referral_status'] ) ) ) { $affiliates_options->update_option( 'totals_referral_status', $referral_status ); } else { $referral_status = null; $affiliates_options->delete_option( 'totals_referral_status' ); } if ( !empty( $_POST['currency_id'] ) && ( $currency_id = Affiliates_Utility::verify_currency_id( $_POST['currency_id'] ) ) ) { $affiliates_options->update_option( 'totals_currency_id', $currency_id ); } else { $currency_id = null; $affiliates_options->delete_option( 'totals_currency_id' ); } if ( !empty( $_POST['affiliate_name'] ) ) { $affiliate_name = $_POST['affiliate_name']; $affiliates_options->update_option( 'totals_affiliate_name', $affiliate_name ); } else { $affiliate_name = null; $affiliates_options->delete_option( 'totals_affiliate_name' ); } if ( !empty( $_POST['affiliate_user_login'] ) ) { $affiliate_user_login = $_POST['affiliate_user_login']; $affiliates_options->update_option( 'totals_affiliate_user_login', $affiliate_user_login ); } else { $affiliate_user_login = null; $affiliates_options->delete_option( 'totals_affiliate_user_login' ); } $show_deleted = isset( $_POST['show_deleted'] ); $affiliates_options->update_option( 'totals_show_deleted', $show_deleted ); $show_inoperative = isset( $_POST['show_inoperative'] ); $affiliates_options->update_option( 'totals_show_inoperative', $show_inoperative ); if ( !empty( $_POST['from_date'] ) ) { $IXAP15 = date( 'Y-m-d', strtotime( $_POST['from_date'] ) ); $affiliates_options->update_option( 'totals_from_date', $IXAP15 ); } else { $IXAP15 = null; $affiliates_options->delete_option( 'totals_from_date' ); } if ( !empty( $_POST['thru_date'] ) ) { $IXAP16 = date( 'Y-m-d', strtotime( $_POST['thru_date'] ) ); $affiliates_options->update_option( 'totals_thru_date', $IXAP16 ); } else { $IXAP16 = null; $affiliates_options->delete_option( 'totals_thru_date' ); } if ( $IXAP15 && $IXAP16 ) { if ( strtotime( $IXAP15 ) > strtotime( $IXAP16 ) ) { $IXAP16 = null; $affiliates_options->delete_option( 'totals_thru_date' ); } } if ( !empty( $_POST['affiliate_id'] ) ) { $affiliate_id = affiliates_check_affiliate_id( $_POST['affiliate_id'] ); if ( $affiliate_id ) { $affiliates_options->update_option( 'totals_affiliate_id', $affiliate_id ); } } else if ( isset( $_POST['affiliate_id'] ) ) { $affiliate_id = null; $affiliates_options->delete_option( 'totals_affiliate_id' ); } } if ( isset( $_POST['row_count'] ) ) { if ( !wp_verify_nonce( $_POST[self::NONCE_1], self::SET_RPP ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } if ( isset( $_POST['paged'] ) ) { if ( !wp_verify_nonce( $_POST[self::NONCE_2], self::SET_PAGE ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP59 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IXAP59 = remove_query_arg( 'paged', $IXAP59 ); $IXAP59 = remove_query_arg( 'action', $IXAP59 ); $IXAP59 = remove_query_arg( 'affiliate_id', $IXAP59 ); $referrals_table = $affiliates_db->get_tablename( 'referrals' ); $affiliates_table = $affiliates_db->get_tablename( 'affiliates' ); $affiliates_users_table = $affiliates_db->get_tablename( 'affiliates_users' ); $IXAP34 .= '<div class="totals">' . '<div>' . '<h1>' . __( 'Totals', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</h1>' . '</div>'; $IXAP247 = isset( $_POST['row_count'] ) ? intval( $_POST['row_count'] ) : 0; if ($IXAP247 <= 0) { $IXAP247 = $affiliates_options->get_option( 'totals_per_page', self::IXAP333 ); } else { $affiliates_options->update_option('totals_per_page', $IXAP247 ); } $IXAP248 = isset( $_GET['offset'] ) ? intval( $_GET['offset'] ) : 0; if ( $IXAP248 < 0 ) { $IXAP248 = 0; } $IXAP249 = isset( $_REQUEST['paged'] ) ? intval( $_REQUEST['paged'] ) : 0; if ( $IXAP249 < 0 ) { $IXAP249 = 0; } $IXAP68 = isset( $_GET['orderby'] ) ? $_GET['orderby'] : null; switch ( $IXAP68 ) { case 'affiliate_id' : case 'name' : case 'user_login' : case 'email' : case 'total' : case 'currency_id' : break; default: $IXAP68 = 'name'; } $IXAP69 = isset( $_GET['order'] ) ? $_GET['order'] : null; switch ( $IXAP69 ) { case 'asc' : case 'ASC' : $switch_order = 'DESC'; break; case 'desc' : case 'DESC' : $switch_order = 'ASC'; break; default: $IXAP69 = 'ASC'; $switch_order = 'DESC'; } $IXAP179 = array( " 1=%d " ); $IXAP180 = array( 1 ); if ( $affiliate_id ) { $IXAP179[] = " a.affiliate_id = %d "; $IXAP180[] = $affiliate_id; } if ( $affiliate_name ) { $IXAP179[] = " a.name LIKE '%%%s%%' "; $IXAP180[] = $affiliate_name; } if ( $affiliate_user_login ) { $IXAP179[] = " u.user_login LIKE '%%%s%%' "; $IXAP180[] = $affiliate_user_login; } if ( $IXAP15 ) { $IXAP20 = DateHelper::u2s( $IXAP15 ); } if ( $IXAP16 ) { $IXAP21 = DateHelper::u2s( $IXAP16, 24*3600 ); } if ( $IXAP20 && $IXAP21 ) { $IXAP179[] = " r.datetime >= %s AND r.datetime < %s "; $IXAP180[] = $IXAP20; $IXAP180[] = $IXAP21; } else if ( $IXAP20 ) { $IXAP179[] = " r.datetime >= %s "; $IXAP180[] = $IXAP20; } else if ( $IXAP21 ) { $IXAP179[] = " r.datetime < %s "; $IXAP180[] = $IXAP21; } if ( $affiliate_status ) { $IXAP179[] = " a.status = %s "; $IXAP180[] = $affiliate_status; } if ( $referral_status ) { $IXAP179[] = " r.status = %s "; $IXAP180[] = $referral_status; } if ( $currency_id ) { $IXAP179[] = " r.currency_id = %s "; $IXAP180[] = $currency_id; } if ( !empty( $IXAP179 ) ) { $IXAP179 = " WHERE " . implode( " AND ", $IXAP179 ); } else { $IXAP179 = ''; } $IXAP181 = ''; if ( $IXAP178 ) { $IXAP181 .= " HAVING SUM(r.amount) >= %s "; $IXAP180[] = $IXAP178; } $IXAP251 = $affiliates_db->get_value( "
			SELECT COUNT(*) FROM (
			SELECT r.affiliate_id
			FROM $referrals_table r
			LEFT JOIN $affiliates_table a ON r.affiliate_id = a.affiliate_id
			LEFT JOIN $affiliates_users_table au ON a.affiliate_id = au.affiliate_id
			LEFT JOIN $wpdb->users u on au.user_id = u.ID
			$IXAP179 
			GROUP BY r.affiliate_id, r.currency_id
			$IXAP181
			) tmp
			", $IXAP180 ); if ( $IXAP251 > $IXAP247 ) { $IXAP252 = true; } else { $IXAP252 = false; } $IXAP75 = ceil ( $IXAP251 / $IXAP247 ); if ( $IXAP249 > $IXAP75 ) { $IXAP249 = $IXAP75; } if ( $IXAP249 != 0 ) { $IXAP248 = ( $IXAP249 - 1 ) * $IXAP247; } $IXAP26 = $affiliates_db->get_objects( "
			SELECT a.*, u.user_login, SUM(r.amount) as total, r.currency_id
			FROM $referrals_table r
			LEFT JOIN $affiliates_table a ON r.affiliate_id = a.affiliate_id
			LEFT JOIN $affiliates_users_table au ON a.affiliate_id = au.affiliate_id
			LEFT JOIN $wpdb->users u on au.user_id = u.ID
			$IXAP179
			GROUP BY r.affiliate_id, r.currency_id
			$IXAP181
			ORDER BY $IXAP68 $IXAP69 LIMIT $IXAP247 OFFSET $IXAP248
			", $IXAP180 ); $IXAP105 = array( 'affiliate_id' => __( 'Id', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'name' => __( 'Affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'email' => __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'user_login' => __( 'Username', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'total' => __( 'Total', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'currency_id' => __( 'Currency', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); $IXAP34 .= '<div class="totals-overview">'; $IXAP185 = ""; if ( !empty( $IXAP15 ) ) { $IXAP185 .= "&from_date=" . urlencode( $IXAP15 ); } if ( !empty( $IXAP16 ) ) { $IXAP185 .= "&thru_date=" . urlencode( $IXAP16 ); } if ( !empty( $IXAP178 ) ) { $IXAP185 .= "&minimum_total=" . urlencode( $IXAP178 ); } if ( !empty( $affiliate_status ) ) { $IXAP185 .= "&affiliate_status=" . urlencode( $affiliate_status ); } if ( !empty( $referral_status ) ) { $IXAP185 .= "&referral_status=" . urlencode( $referral_status ); } if ( !empty( $currency_id ) ) { $IXAP185 .= "&currency_id=" . urlencode( $currency_id ); } if ( !empty( $affiliate_id ) ) { $IXAP185 .= "&affiliate_id=" . urlencode( $affiliate_id ); } if ( !empty( $affiliate_name ) ) { $IXAP185 .= "&affiliate_name=" . urlencode( $affiliate_name ); } if ( !empty( $affiliate_user_login ) ) { $IXAP185 .= "&affiliate_user_login=" . urlencode( $affiliate_user_login ); } if ( !empty( $IXAP68 ) ) { $IXAP185 .= "&orderby=" . urlencode( $IXAP68 ); } if ( !empty( $IXAP69 ) ) { $IXAP185 .= "&order=" . urlencode( $IXAP69 ); } $IXAP186 = esc_url( AFFILIATES_PRO_PLUGIN_URL . 'lib/ext/includes/generate-mass-payment-file.php' ); $IXAP34 .= '<div class="manage">'; $IXAP34 .= "<p>"; $IXAP34 .= "<a target='_blank' title='" . __( 'Export to File', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "' " . "class='button generate export' " . "href='" . $IXAP186 . "?action=generate_mass_payment_file&service=export" . $IXAP185 . "'>" . "<img class='icon' alt='" . __( 'Generate', AFFILIATES_PRO_PLUGIN_DOMAIN) . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/export.png'/>" . "<span class='label'>" . __( 'Export', AFFILIATES_PRO_PLUGIN_DOMAIN) . "</span>" . "</a>"; $IXAP34 .= "<a target='_blank' title='" . __( 'Generate a Mass Payment File', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "' " . "class='button generate paypal' " . "href='" . $IXAP186 . "?action=generate_mass_payment_file&service=paypal" . $IXAP185 . "'>" . "<img class='icon' alt='" . __( 'Generate', AFFILIATES_PRO_PLUGIN_DOMAIN) . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/export.png'/>" . "<span class='label'>" . __( 'Mass Payment File', AFFILIATES_PRO_PLUGIN_DOMAIN) . "</span>" . "</a>"; $IXAP34 .= "<a title='" . __( 'Click to close these referrals', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "' " . "class='button close-referrals' " . "href='" . esc_url( $IXAP59 ) . "&action=close_referrals" . $IXAP185 . "'>" . "<img class='icon' alt='" . __( 'Close referrals', AFFILIATES_PRO_PLUGIN_DOMAIN) . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/closed.png'/>" . "<span class='label'>" . __( 'Close Referrals', AFFILIATES_PRO_PLUGIN_DOMAIN) . "</span>" . "</a>"; $IXAP34 .= "</p>"; $IXAP34 .= '<ul>'; $IXAP34 .= '<li>'; $IXAP34 .= __( '<strong>Export</strong> : Export the current totals listing to a file.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</li>'; $IXAP34 .= '<li>'; $IXAP34 .= __( '<strong>Mass Payment File</strong> : Export the current totals for mass payment compatible with the PayPal file format<sup>*</sup>.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</li>'; $IXAP34 .= '<li>'; $IXAP34 .= '</ul>'; $IXAP34 .= '<p style="font-size:0.92em">'; $IXAP34 .= sprintf( __( "<sup>*</sup>Note that the PayPal Mass Payment <a target='_blank' href='%s'>File Format</a> allows only one currency type per Mass Payment file.", AFFILIATES_PRO_PLUGIN_DOMAIN ), "https://www.paypal.com/cgi-bin/webscr?cmd=_batch-payment-format-outside" ); $IXAP34 .= ' '; $IXAP34 .= __( 'Use the <em>Currency</em> filter to restrict the listing to one currency.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= ' '; $IXAP34 .= __( 'Where a specific PayPal email address is on file for an affiliate, it will be used.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</p>'; $IXAP34 .= '</div>'; $affiliate_status_descriptions = array( AFFILIATES_AFFILIATE_STATUS_ACTIVE => __( 'Active', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_AFFILIATE_STATUS_PENDING => __( 'Pending', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_AFFILIATE_STATUS_DELETED => __( 'Deleted', AFFILIATES_PLUGIN_DOMAIN ), ); $affiliate_status_select = '<label class="affiliate-status-filter" for="affiliate_status">' . __('Affiliate Status', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>'; $affiliate_status_select .= '<select class="affiliate-status-filter" name="affiliate_status">'; $affiliate_status_select .= '<option value="" ' . ( empty( $affiliate_status ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $affiliate_status_descriptions as $key => $IXAP161 ) { $selected = $key == $affiliate_status ? ' selected="selected" ' : ''; $affiliate_status_select .= '<option ' . $selected . ' value="' . esc_attr( $key ) . '">' . $IXAP161 . '</option>'; } $affiliate_status_select .= '</select>'; $status_descriptions = array( AFFILIATES_REFERRAL_STATUS_ACCEPTED => __( 'Accepted', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_CLOSED => __( 'Closed', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_PENDING => __( 'Pending', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_REJECTED => __( 'Rejected', AFFILIATES_PLUGIN_DOMAIN ), ); $status_select = '<label class="referral-status-filter" for="referral_status">' . __('Referral Status', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>'; $status_select .= '<select class="referral-status-filter" name="referral_status">'; $status_select .= '<option value="" ' . ( empty( $referral_status ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $status_descriptions as $key => $IXAP161 ) { $selected = $key == $referral_status ? ' selected="selected" ' : ''; $status_select .= '<option ' . $selected . ' value="' . esc_attr( $key ) . '">' . $IXAP161 . '</option>'; } $status_select .= '</select>'; $IXAP334 = $affiliates_db->get_objects( "SELECT DISTINCT(currency_id) FROM $referrals_table WHERE currency_id IS NOT NULL" ); $IXAP335 = '<label class="currency-id-filter" for="currency_id">' . __( 'Currency', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>'; $IXAP335 .= '<select class="currency-id-filter" name="currency_id">'; $IXAP335 .= '<option value="" ' . ( empty( $currency_id ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $IXAP334 as $IXAP45 ) { $selected = $IXAP45->currency_id == $currency_id ? ' selected="selected" ' : ''; $IXAP335 .= '<option ' . $selected . ' value="' . esc_attr( $IXAP45->currency_id ) . '">' . $IXAP45->currency_id . '</option>'; } $IXAP335 .= '</select>'; $IXAP34 .= '<div class="filters">' . '<label class="description" for="setfilters">' . __( 'Filters', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<form id="setfilters" action="" method="post">' . '<p>' . $status_select . '<label class="minimum-total-filter" for="minimum_total">' . __( 'Minimum Total', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="minimum-total-filter" name="minimum_total" type="text" value="' . esc_attr( $IXAP178 ) . '"/>' . $IXAP335 . '</p>' . '<p>' . '<label class="affiliate-id-filter" for="affiliate_id">' . __( 'Affiliate Id', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="affiliate-id-filter" name="affiliate_id" type="text" value="' . esc_attr( $affiliate_id ) . '"/>' . '<label class="affiliate-name-filter" for="affiliate_name">' . __( 'Affiliate Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="affiliate-name-filter" name="affiliate_name" type="text" value="' . $affiliate_name . '"/>' . '<label class="affiliate-user-login-filter" for="affiliate_user_login">' . __( 'Affiliate Username', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="affiliate-user-login-filter" name="affiliate_user_login" type="text" value="' . $affiliate_user_login . '" />' . '</p>' . '<p>' . '<label class="from-date-filter" for="from_date">' . __( 'From', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="datefield from-date-filter" name="from_date" type="text" value="' . esc_attr( $IXAP15 ) . '"/>'. '<label class="thru-date-filter" for="thru_date">' . __( 'Until', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input class="datefield thru-date-filter" name="thru_date" type="text" class="datefield" value="' . esc_attr( $IXAP16 ) . '"/>'. $affiliate_status_select . '</p>
					<p>' . wp_nonce_field( self::SET_FILTERS, self::NONCE, true, false ) . '<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input class="button" type="submit" name="clear_filters" value="' . __( 'Clear', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</p>' . '</form>' . '</div>'; $IXAP34 .= '
			<div class="page-options">
				<form id="setrowcount" action="" method="post">
					<div>
						<label for="row_count">' . __('Results per page', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input name="row_count" type="text" size="2" value="' . esc_attr( $IXAP247 ) .'" />
						' . wp_nonce_field( self::SET_RPP, self::NONCE_1, true, false ) . '
						<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>
					</div>
				</form>
			</div>
			'; if ( $IXAP252 ) { $IXAP253 = new Affiliates_Pagination( $IXAP251, null, $IXAP247 ); $IXAP34 .= '<form id="posts-filter" method="post" action="">'; $IXAP34 .= '<div>'; $IXAP34 .= wp_nonce_field( self::SET_PAGE, self::NONCE_2, true, false ); $IXAP34 .= '</div>'; $IXAP34 .= '<div class="tablenav top">'; $IXAP34 .= $IXAP253->pagination( 'top' ); $IXAP34 .= '</div>'; $IXAP34 .= '</form>'; } $IXAP34 .= '
			<table class="wp-list-table widefat fixed" cellspacing="0">
			<thead>
				<tr>
				'; foreach ( $IXAP105 as $key => $IXAP106 ) { $IXAP24 = array( 'orderby' => $key, 'order' => $switch_order ); $IXAP107 = $key; if ( !in_array($key, array( 'edit', 'remove', 'links' ) ) ) { if ( strcmp( $key, $IXAP68 ) == 0 ) { $IXAP108 = strtolower( $IXAP69 ); $IXAP107 = "$key manage-column sorted $IXAP108"; } else { $IXAP107 = "$key manage-column sortable"; } $IXAP106 = '<a href="' . esc_url( add_query_arg( $IXAP24, $IXAP59 ) ) . '"><span>' . $IXAP106 . '</span><span class="sorting-indicator"></span></a>'; } $IXAP34 .= "<th scope='col' class='$IXAP107'>$IXAP106</th>"; } $IXAP34 .= '</tr>
			</thead>
			<tbody>
			'; if ( count( $IXAP26 ) > 0 ) { for ( $i = 0; $i < count( $IXAP26 ); $i++ ) { $IXAP11 = $IXAP26[$i]; $name_suffix = ''; $IXAP112 = ''; if ( $is_deleted = ( strcmp( $IXAP11->status, 'deleted' ) == 0 ) ) { $IXAP112 = ' deleted '; $name_suffix .= " " . __( '(removed)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } $IXAP113 = ''; if ( $is_inoperative = ! ( ( $IXAP11->from_date <= $IXAP83 ) && ( $IXAP11->thru_date == null || $IXAP11->thru_date >= $IXAP83 ) ) ) { $IXAP113 = ' inoperative '; $name_suffix .= " " . __( '(inoperative)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } $IXAP34 .= '<tr class="' . $IXAP112 . $IXAP113 . ( $i % 2 == 0 ? 'even' : 'odd' ) . '">'; $IXAP34 .= "<td class='affiliate-id'>"; if ( affiliates_encode_affiliate_id( $IXAP11->affiliate_id ) != $IXAP11->affiliate_id ) { $IXAP34 .= '<span class="encoded-hint" title="' . affiliates_encode_affiliate_id( $IXAP11->affiliate_id ) . '">' . $IXAP11->affiliate_id . '</span>'; } else { $IXAP34 .= $IXAP11->affiliate_id; } $IXAP34 .= "</td>"; $IXAP34 .= "<td class='affiliate-name'>" . stripslashes( wp_filter_nohtml_kses( $IXAP11->name ) ) . $name_suffix . "</td>"; $IXAP34 .= "<td class='affiliate-email'>" . $IXAP11->email . "</td>"; $IXAP34 .= "<td class='affiliate-user-login'>" . $IXAP11->user_login . "</td>"; $IXAP34 .= "<td class='total'>$IXAP11->total</td>"; $IXAP34 .= "<td class='currency-id'>$IXAP11->currency_id</td>"; $IXAP34 .= '</tr>'; } } else { $IXAP34 .= '<tr><td colspan="' . count( $IXAP105 ) . '">' . __( 'There are no results.', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</td></tr>'; } $IXAP34 .= '</tbody>'; $IXAP34 .= '</table>'; if ( $IXAP252 ) { $IXAP253 = new Affiliates_Pagination($IXAP251, null, $IXAP247); $IXAP34 .= '<div class="tablenav bottom">'; $IXAP34 .= $IXAP253->pagination( 'bottom' ); $IXAP34 .= '</div>'; } $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; echo $IXAP34; affiliates_footer(); } } 