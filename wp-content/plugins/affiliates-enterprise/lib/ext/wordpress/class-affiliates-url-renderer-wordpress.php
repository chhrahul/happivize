<?php
 class Affiliates_Url_Renderer_WordPress extends Affiliates_Url_Renderer { const NONCE = 'affiliate-nonce'; const NONCE_1 = 'affiliate-nonce-1'; const NONCE_2 = 'affiliate-nonce-2'; const NONCE_FILTERS = 'affiliate-nonce-filters'; static function init() { self::$IXAP5 = get_option( 'aff_pname', AFFILIATES_PNAME ); self::$IXAP6 = 'cmid'; self::$IXAP29 = 'affiliates_encode_affiliate_id'; add_shortcode( 'affiliates_affiliate_url', array( 'Affiliates_Url_Renderer_WordPress', 'url_shortcode' ) ); add_shortcode( 'affiliates_generate_url', array( 'Affiliates_Url_Renderer_WordPress', 'generate_url_shortcode' ) ); } static function url_shortcode( $IXAP31, $IXAP32 = null ) { $IXAP24 = shortcode_atts( self::$IXAP192, $IXAP31 ); return self::render_affiliate_url( $IXAP24 ); } static function render_affiliate_url( $IXAP24 = array() ) { global $wp_rewrite; $IXAP34 = ''; if ( !isset( $IXAP24['url'] ) ) { $IXAP24['url'] = get_bloginfo( 'url' ); } $IXAP24['pname'] = get_option( 'aff_pname', AFFILIATES_PNAME ); $IXAP34 .= parent::render_affiliate_url( $IXAP24, array( 'Affiliates_Affiliate' => 'Affiliates_Affiliate_WordPress', 'affiliate_id_encoder' => 'affiliates_encode_affiliate_id', 'esc_attr' => 'esc_attr', 'use_parameter' => !$wp_rewrite->using_permalinks() ) ); return $IXAP34; } public static function generate_url_shortcode( $IXAP31, $IXAP32 = null ) { $IXAP31 = shortcode_atts( array( 'campaign' => 'no' ), $IXAP31 ); $IXAP344 = isset( $_POST['generate-url'] ) ? trim( $_POST['generate-url'] ) : ''; if ( !empty( $IXAP344 ) ) { if ( ( stripos( $IXAP344, 'http://' ) !== 0 ) && ( stripos( $IXAP344, 'https://' ) !== 0 ) ) { $IXAP344 = 'http://' . $IXAP344; } } $IXAP345 = true; if ( !empty( $IXAP344 ) ) { if ( function_exists( 'filter_var' ) ) { $IXAP345 = filter_var( $IXAP344, FILTER_VALIDATE_URL ) !== false; } } $affiliate_url = !empty( $IXAP344 ) ? self::render_affiliate_url( array( 'url' => $IXAP344, 'type' => self::TYPE_APPEND ) ) : ''; if ( class_exists( 'Affiliates_Campaign' ) ) { if ( !empty( $IXAP344 ) ) { $IXAP12 = !empty( $_POST['campaign_id'] ) ? intval( $_POST['campaign_id'] ) : null; if ( $IXAP12 ) { if ( $affiliate_ids = affiliates_get_user_affiliate( get_current_user_id() ) ) { if ( $affiliate_id = array_shift( $affiliate_ids ) ) { if ( $IXAP10 = Affiliates_Campaign::get_affiliate_campaign( $affiliate_id, $IXAP12 ) ) { $affiliate_url = $IXAP10->get_url( array( 'url' => $IXAP344 ) ); } } } } } } $IXAP34 = ''; $style = apply_filters( 'affiliates_generate_url_style', 'div.generate-field span.field-label { display:block; }' . 'div.generate-field span.field-input { display:block; width:62%; }' . 'div.generate-field span.field-input input { width:100%; }' . 'div.generate-field span.error { display:block; color: #900; }' ); if ( !empty( $style ) ) { $IXAP34 .= '<style type="text/css">'; $IXAP34 .= $style; $IXAP34 .= '</style>'; } $IXAP34 .= '<div class="affiliates-generate-url">'; $IXAP34 .= '<form action="" method="post">'; $IXAP34 .= '<div>'; $IXAP34 .= '<div class="generate-field generate-url">'; $IXAP34 .= '<label>'; $IXAP34 .= '<span class="field-label">'; $IXAP34 .= __( 'Page URL', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</span>'; $IXAP34 .= sprintf( '<span class="error" style="%s">', $IXAP345 ? 'display:none;' : '' ); $IXAP34 .= __( 'Please enter a valid URL.', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</span>'; $IXAP34 .= '<span class="field-input">'; $IXAP34 .= sprintf( '<input type="text" name="generate-url" value="%s" />', $IXAP344 ); $IXAP34 .= '</span>'; $IXAP34 .= '</label>'; $IXAP34 .= '</div>'; if ( class_exists( 'Affiliates_Campaign' ) && isset( $IXAP31['campaign'] ) && strtolower( $IXAP31['campaign'] ) == 'yes' ) { if ( $affiliate_ids = affiliates_get_user_affiliate( get_current_user_id() ) ) { if ( $affiliate_id = array_shift( $affiliate_ids ) ) { $IXAP25 = Affiliates_Campaign::get_campaigns( $affiliate_id ); if ( !empty( $IXAP25 ) ) { $selected_campaign_id = null; $IXAP12 = !empty( $_POST['campaign_id'] ) ? intval( $_POST['campaign_id'] ) : null; if ( $IXAP12 ) { if ( $IXAP10 = Affiliates_Campaign::get_affiliate_campaign( $affiliate_id, $IXAP12 ) ) { $selected_campaign_id = $IXAP10->campaign_id; } } $IXAP34 .= '<div class="generate-field campaign">'; $IXAP34 .= '<label>'; $IXAP34 .= '<span class="field-label">'; $IXAP34 .= __( 'Campaign', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</span>'; $IXAP34 .= '<select name="campaign_id">'; $IXAP34 .= '<option value="">&mdash;</option>'; foreach( $IXAP25 as $IXAP10 ) { $IXAP34 .= sprintf( '<option value="%d" %s>%s</option>', intval( $IXAP10->campaign_id ), $selected_campaign_id !== null && $IXAP10->campaign_id == $selected_campaign_id ? ' selected="selected" ' : '', esc_html( stripslashes( $IXAP10->name ) ) ); } $IXAP34 .= '</select>'; $IXAP34 .= '</label>'; $IXAP34 .= '</div>'; } } } } $IXAP34 .= '<div class="generate-field affiliate-url">'; $IXAP34 .= '<label>'; $IXAP34 .= '<span class="field-label">'; $IXAP34 .= __( 'Affiliate URL', AFFILIATES_PRO_PLUGIN_DOMAIN ); $IXAP34 .= '</span>'; $IXAP34 .= '<span class="field-input">'; $IXAP34 .= sprintf( '<input type="text" name="affiliate-url" value="%s" readonly="readonly" />', $affiliate_url ); $IXAP34 .= '</span>'; $IXAP34 .= '</label>'; $IXAP34 .= '</div>'; $IXAP34 .= '<div class="generate-button">'; $IXAP34 .= sprintf( '<input type="submit" name="generate" value="%s" />', __( 'Generate', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); $IXAP34 .= '</div>'; $IXAP34 .= '</div>'; $IXAP34 .= '</form>'; $IXAP34 .= '</div>'; return $IXAP34; } } Affiliates_Url_Renderer_WordPress::init(); 