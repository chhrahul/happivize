<?php
 global $affiliates_options, $affiliates_version, $affiliates_pro_version, $affiliates_pro_admin_messages; if ( !isset( $affiliates_pro_admin_messages ) ) { $affiliates_pro_admin_messages = array(); } if ( !isset( $affiliates_pro_version ) ) { $affiliates_pro_version = AFFILIATES_EXT_VERSION; } add_action( 'init', 'affiliates_pro_version_check' ); function affiliates_pro_version_check() { global $affiliates_pro_version, $affiliates_pro_admin_messages; $IXAP114 = get_option( 'affiliates_pro_plugin_version', null ); $affiliates_pro_version = AFFILIATES_EXT_VERSION; if ( version_compare( $IXAP114, $affiliates_pro_version ) < 0 ) { if ( affiliates_pro_update( $IXAP114 ) ) { update_option( 'affiliates_pro_plugin_version', $affiliates_pro_version ); } else { $affiliates_pro_admin_messages[] = '<div class="error">Updating Affiliates Ext FAILED.</div>'; } } } function affiliates_pro_admin_notices() { global $affiliates_pro_admin_messages; if ( !empty( $affiliates_pro_admin_messages ) ) { foreach ( $affiliates_pro_admin_messages as $IXAP102 ) { echo $IXAP102; } } } add_action( 'admin_notices', 'affiliates_pro_admin_notices' ); function affiliates_pro_activate( $network_wide = false ) { if ( is_multisite() && $network_wide ) { $IXAP115 = affiliates_get_blogs(); foreach ( $IXAP115 as $IXAP116 ) { switch_to_blog( $IXAP116 ); wp_cache_reset(); affiliates_pro_setup(); restore_current_blog(); } } else { affiliates_pro_setup(); } } function affiliates_pro_setup() { global $affiliates_db, $wpdb; if ( affiliates_pro_check_dependencies() ) { $charset = null; $IXAP2 = null; if ( ! empty( $wpdb->charset ) ) { $charset = $wpdb->charset; } if ( ! empty( $wpdb->collate ) ) { $IXAP2 = $wpdb->collate; } $affiliates_db->create_tables( $charset, $IXAP2 ); affiliates_pro_update(); } } function affiliates_pro_wpmu_new_blog( $IXAP116, $user_id ) { if ( is_multisite() ) { if ( affiliates_is_sitewide_plugin() ) { switch_to_blog( $IXAP116 ); wp_cache_reset(); affiliates_pro_setup(); restore_current_blog(); } } } function affiliates_pro_delete_blog( $IXAP116, $IXAP117 = false ) { if ( is_multisite() ) { if ( affiliates_is_sitewide_plugin() ) { switch_to_blog( $IXAP116 ); wp_cache_reset(); affiliates_pro_cleanup( $IXAP117 ); restore_current_blog(); } } } register_activation_hook( AFFILIATES_PRO_FILE, 'affiliates_pro_activate' ); add_action( 'wpmu_new_blog', 'affiliates_pro_wpmu_new_blog', 11, 2 ); add_action( 'delete_blog', 'affiliates_pro_delete_blog', 10, 2 ); function affiliates_pro_update( $IXAP114 = null ) { return true; } remove_action( 'deactivate_' . plugin_basename( AFFILIATES_PRO_FILE ), 'affiliates_deactivate' ); register_deactivation_hook( AFFILIATES_PRO_FILE, 'affiliates_pro_deactivate' ); function affiliates_pro_deactivate( $network_wide = false ) { if ( is_multisite() && $network_wide ) { if ( get_option( 'aff_delete_network_data', false ) ) { $IXAP115 = affiliates_get_blogs(); foreach ( $IXAP115 as $IXAP116 ) { switch_to_blog( $IXAP116 ); wp_cache_reset(); affiliates_pro_cleanup( true ); restore_current_blog(); } } } else { affiliates_pro_cleanup(); } affiliates_deactivate( $network_wide ); } function affiliates_pro_cleanup( $IXAP119 = false ) { global $affiliates_db; $IXAP120 = get_option( 'aff_delete_data', false ) || $IXAP119; if ( $IXAP120 ) { $affiliates_db->drop_tables(); delete_option( 'affiliates_pro_plugin_version' ); delete_option( Affiliates_Referral::IXAP121 ); delete_option( Affiliates_Referral::IXAP122 ); delete_option( 'affiliates_notifications' ); } } add_action( 'init', 'affiliates_pro_init' ); function affiliates_pro_init() { global $affiliates_pro_admin_messages; load_plugin_textdomain( AFFILIATES_PRO_PLUGIN_DOMAIN, null, AFFILIATES_PLUGIN_NAME . '/lib/ext/languages' ); affiliates_pro_check_dependencies(); } function affiliates_pro_check_dependencies() { global $affiliates_pro_admin_messages; $IXAP11 = true; $active_plugins = get_option( 'active_plugins', array() ); $affiliates_is_active = in_array( 'affiliates/affiliates.php', $active_plugins ); if ( is_multisite() ) { $IXAP123 = get_site_option( 'active_sitewide_plugins', array() ); $affiliates_is_active = $affiliates_is_active || key_exists( 'affiliates/affiliates.php', $IXAP123 ); } if ( $affiliates_is_active ) { $affiliates_pro_admin_messages[] = "<div class='error'>" . __( 'The <a href="http://www.itthinx.com/plugins/affiliates" target="_blank">Affiliates</a> plugin must be deactivated or removed.', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "</div>"; include_once( ABSPATH . 'wp-admin/includes/plugin.php' ); deactivate_plugins( AFFILIATES_PLUGIN_BASENAME ); $IXAP11 = false; } if ( function_exists( 'fake_bcadd' ) ) { if ( isset( $_GET['page'] ) ) { if ( ( "affiliates-admin-options" == $_GET['page'] ) || ( "affiliates-admin-settings" == $_GET['page'] ) ) { $affiliates_pro_admin_messages[] = "<div class='error'>" . __( 'You are running PHP with <a target="_blank" href="http://www.php.net/manual/en/book.bc.php">BCMath Arbitrary Precision Mathematics</a> disabled. Your <strong>Affiliates</strong> plugin will use substitute functions, but you should seriously consider getting BCMath enabled to avoid loss of precision.', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "</div>"; } } } return $IXAP11; } if ( !function_exists( 'bcadd' ) ) { include_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/fake_bcmath.php' ); } require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/interfaces.php' ); require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/abstract/abstract.php' ); function affiliates_pro_affiliates_attributes_init() { Affiliates_Attributes::set_keys( array( Affiliates_Attributes::IXAP128 => __( 'PayPal Email', AFFILIATES_PRO_PLUGIN_DOMAIN ), Affiliates_Attributes::REFERRAL_AMOUNT => __( 'Referral Amount', AFFILIATES_PRO_PLUGIN_DOMAIN ), Affiliates_Attributes::REFERRAL_AMOUNT_METHOD => __( 'Referral Amount Method', AFFILIATES_PRO_PLUGIN_DOMAIN ), Affiliates_Attributes::REFERRAL_RATE => __( 'Referral Rate', AFFILIATES_PRO_PLUGIN_DOMAIN ), Affiliates_Attributes::IXAP129 => __( 'Coupons', AFFILIATES_PRO_PLUGIN_DOMAIN ), Affiliates_Attributes::IXAP130 => __( 'Cookie Expiration', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); } add_action( 'init', 'affiliates_pro_affiliates_attributes_init' ); require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/wordpress/wordpress.php' ); require_once( AFFILIATES_CORE_LIB . '/class-affiliates-utility.php' ); require_once( AFFILIATES_CORE_LIB . '/class-affiliates-pagination.php' ); require_once( AFFILIATES_CORE_LIB . '/class-affiliates-date-helper.php'); require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/wordpress/class-affiliates-affiliate-stats-widget.php' ); add_action( 'widgets_init', 'affiliates_pro_widgets_init' ); require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/class-affiliates-notifications-extended.php' ); if ( is_admin() ) { require_once dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/wordpress/class-affiliates-admin-notifications-extended.php'; } require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/class-affiliates-export.php' ); require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/class-affiliates-referrals-export.php' ); function affiliates_pro_widgets_init() { register_widget( 'Affiliates_Affiliate_Stats_Widget' ); } add_filter( 'affiliates_footer', array( 'Affiliates_Ext_Footer', 'render' ) ); class Affiliates_Ext_Footer { public static function render( $IXAP237 ) { $plugin_name = ucwords( str_replace( '-', ' ', AFFILIATES_PLUGIN_NAME ) ); $IXAP237 = sprintf( '<div class="%s-footer">', AFFILIATES_PLUGIN_NAME ) . sprintf( '<div class="%s">', AFFILIATES_PLUGIN_NAME ) . sprintf( 'Powered by <a href="%s">%s</a>', sprintf( 'http://www.itthinx.com/plugins/%s', AFFILIATES_PLUGIN_NAME ), sprintf( '<img style="vertical-align:middle" src="http://www.itthinx.com/img/%s/%s.png" alt="Icon"/>%s</a>', AFFILIATES_PLUGIN_NAME, AFFILIATES_PLUGIN_NAME, $plugin_name ) ) . ' ' . sprintf( '<span style="font-size:0.8em">&#169; Copyright %d <a href="http://www.itthinx.com">itthinx</a>', date( 'Y' ) ) . '</span>' . ' ' . '<span style="font-size:0.7em">' . 'Use of this plugin without a granted license constitutes an act of COPYRIGHT INFRINGEMENT and LICENSE VIOLATION.' . ' ' . 'This plugin contains parts that are provided under the GPLv3 License and strictly independent proprietary parts to which the GPLv3 License does not apply.' . ' ' . 'You MUST be granted a license by the copyright holder for those parts that are not provided under the GPLv3 license.' . ' ' . 'If you have not obtained a license by the copyright holder, you should remove this plugin and use the fully GPLv3-licensed <a href="http://www.itthinx.com/plugins/affiliates/">Affiliates</a> plugin instead.' . '</span>' . '</div>' . '</div>'; return $IXAP237; } } add_action( 'admin_init', 'affiliates_pro_admin_init' ); function affiliates_pro_admin_init() { global $affiliates_pro_version; wp_register_style( 'smoothness', AFFILIATES_CORE_URL . '/css/smoothness/jquery-ui-1.8.16.custom.css', array(), $affiliates_pro_version ); wp_register_style( 'affiliates_pro_admin', AFFILIATES_PRO_PLUGIN_URL . 'css/affiliates_pro_admin.css', array(), $affiliates_pro_version ); } add_action( 'affiliates_admin_menu', 'affiliates_pro_affiliates_admin_menu' ); function affiliates_pro_affiliates_admin_menu( $IXAP75 ) { foreach ( $IXAP75 as $IXAP57 ) { add_action( 'admin_print_styles-' . $IXAP57, 'affiliates_pro_admin_print_styles' ); add_action( 'admin_print_scripts-' . $IXAP57, 'affiliates_pro_admin_print_scripts' ); } } add_filter( 'affiliates_add_submenu_page_function', 'affiliates_pro_affiliates_add_submenu_page_function' ); function affiliates_pro_affiliates_add_submenu_page_function( $IXAP346 ) { if ( $IXAP346 == 'affiliates_admin_affiliates' ) { $affiliates_affiliates = new Affiliates_Affiliates_WordPress(); return array( $affiliates_affiliates, 'view' ); } else { return $IXAP346; } } function affiliates_pro_admin_print_styles() { wp_enqueue_style( 'smoothness' ); wp_enqueue_style( 'affiliates_pro_admin' ); } function affiliates_pro_admin_print_scripts() { global $affiliates_pro_version; wp_enqueue_script( 'datepicker', AFFILIATES_PRO_PLUGIN_URL . 'js/jquery.ui.datepicker.min.js', array( 'jquery', 'jquery-ui-core' ), $affiliates_pro_version ); wp_enqueue_script( 'datepickers', AFFILIATES_PRO_PLUGIN_URL . 'js/datepickers.js', array( 'jquery', 'jquery-ui-core', 'datepicker' ), $affiliates_pro_version ); wp_enqueue_script( 'jquery-corner', AFFILIATES_PRO_PLUGIN_URL . 'js/jquery.corner.js', array( 'jquery', 'jquery-ui-core' ), $affiliates_pro_version ); wp_enqueue_script( 'affiliates-pro', AFFILIATES_PRO_PLUGIN_URL . 'js/affiliates-pro.js', array( 'jquery' ), $affiliates_pro_version ); } add_action( 'wp_enqueue_scripts', 'affiliates_pro_wp_enqueue_scripts' ); function affiliates_pro_wp_enqueue_scripts() { global $affiliates_pro_version; wp_register_style( 'affiliates-pro', AFFILIATES_PRO_PLUGIN_URL . 'css/affiliates_pro.css', array(), AFFILIATES_EXT_VERSION ); wp_register_style( 'smoothness', AFFILIATES_CORE_URL . 'css/smoothness/jquery-ui-1.8.16.custom.css', array(), AFFILIATES_EXT_VERSION ); wp_register_script( 'excanvas', AFFILIATES_PLUGIN_URL . 'js/graph/flot/excanvas.min.js', array( 'jquery' ), AFFILIATES_EXT_VERSION ); wp_register_script( 'flot', AFFILIATES_PLUGIN_URL . 'js/graph/flot/jquery.flot.min.js', array( 'jquery' ), AFFILIATES_EXT_VERSION ); wp_register_script( 'flot-resize', AFFILIATES_PLUGIN_URL . 'js/graph/flot/jquery.flot.resize.min.js', array( 'jquery', 'flot' ), AFFILIATES_EXT_VERSION ); wp_register_script( 'datepicker', AFFILIATES_CORE_URL . 'js/jquery.ui.datepicker.min.js', array( 'jquery', 'jquery-ui-core' ), AFFILIATES_EXT_VERSION, true ); wp_register_script( 'datepickers', AFFILIATES_CORE_URL . 'js/datepickers.js', array( 'jquery', 'jquery-ui-core', 'datepicker' ), AFFILIATES_EXT_VERSION, true ); } add_action( 'affiliates_cookie_timeout_days', 'affiliates_get_affiliates_cookie_timeout_days', 10, 2 ); function affiliates_get_affiliates_cookie_timeout_days( $IXAP347, $affiliate_id ) { global $affiliates_db; $affiliates_attributes_table = $affiliates_db->get_tablename( 'affiliates_attributes' ); $IXAP348 = $affiliates_db->get_value( "SELECT attr_value FROM $affiliates_attributes_table WHERE affiliate_id = %d AND attr_key = %s", $affiliate_id, Affiliates_Attributes::IXAP130 ); if ( $IXAP348 !== null ) { $IXAP347 = intval( $IXAP348 ); } return $IXAP347; } 