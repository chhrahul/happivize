/*
   2014-2017 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license     GNU GPL version 3 or later
*/
if("undefined"==typeof Solo)var Solo={};"undefined"==typeof Solo.Restore&&(Solo.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null,password:null,ajaxURL:null,mainURL:null,translations:{}});Solo.Restore.errorCallbackDefault=function(a){document.getElementById("restoration-progress").style.display="none";document.getElementById("restoration-error").style.display="block";document.getElementById("backup-error-message").innerHTML=a};
Solo.Restore.doAjax=function(a,b,d){json=JSON.stringify(a);0<Solo.Restore.password.length&&(json=AesCtr.encrypt(json,Solo.Restore.password,128));a={json:json};var g=(new Date).getTime()/1E3,k=parseInt(g,10);a._cacheBustingJunk=Math.round(1E3*(g-k));Solo.Ajax.ajax({type:"POST",url:Solo.Restore.ajaxURL,cache:!1,data:a,timeout:6E5,success:function(a){var e=a.indexOf("###");if(-1==e)a="Invalid AJAX data: "+a,null==d?null!=Solo.Restore.errorCallback?Solo.Restore.errorCallback(a):Solo.Restore.errorCallbackDefault(a):
d(a);else{0!=e&&(a.substr(0,e),a=a.substr(e));a=a.substr(3);var e=a.lastIndexOf("###"),e=a=a.substr(0,e),f=null,c=null;0<Solo.Restore.password.length&&(a=AesCtr.decrypt(a,Solo.Restore.password,128));try{c=JSON.parse(a)}catch(h){f=h}if(null!=f)try{c=JSON.parse(e),f=null}catch(h){}if(null!=f){errorMessage=f.message+"\n<br/>\n<pre>\n"+a+"\n</pre>";if(null!=d){d(errorMessage);return}if(null!=Solo.Restore.errorCallback){Solo.Restore.errorCallback(errorMessage);return}Solo.Restore.errorCallbackDefault(errorMessage)}b(c)}},
error:function(a,b,f){f=a.responseText?a.responseText:"";var c="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+a.status+" ("+a.statusText+")<br/>",c=c+"Internal status: "+b+"<br/>XHR ReadyState: "+a.readyState+"<br/>",c=c+"Raw server response:<br/>"+Solo.System.sanitizeErrorMessage(f);null==d?null!=Solo.Restore.errorCallback?Solo.Restore.errorCallback(c):Solo.Restore.errorCallbackDefault(c):d(c)}})};
Solo.Restore.startTimeoutBar=function(a,b){Solo.Restore.resetTimeoutBar();Solo.Restore.timer=setInterval(function(){Solo.Restore.lastResponseSeconds++;var a=Solo.Restore.translations.COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE.replace("%s",Solo.Restore.lastResponseSeconds.toFixed(0));try{document.querySelector("#response-timer div.text").textContent=a}catch(g){}},1E3)};
Solo.Restore.resetTimeoutBar=function(){Solo.Restore.lastResponseSeconds=0;if(0!=Solo.Restore.timer){clearInterval(Solo.Restore.timer);Solo.Restore.timer=0;var a=document.getElementById("response-timer").querySelector("div.text");try{a.textContent=Solo.Restore.translations.COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE.replace("%s","0")}catch(b){}}};
Solo.Restore.pingRestoration=function(){Solo.Restore.statistics.inbytes=0;Solo.Restore.statistics.outbytes=0;Solo.Restore.statistics.files=0;Solo.Restore.startTimeoutBar(5E3,80);Solo.Restore.doAjax({task:"ping"},function(a){Solo.Restore.start(a)})};Solo.Restore.start=function(){Solo.Restore.statistics.inbytes=0;Solo.Restore.statistics.outbytes=0;Solo.Restore.statistics.files=0;Solo.Restore.startTimeoutBar(5E3,80);Solo.Restore.doAjax({task:"startRestore"},function(a){Solo.Restore.step(a)})};
Solo.Restore.step=function(a){Solo.Restore.resetTimeoutBar();if(0==a.status)Solo.Restore.errorCallbackDefault(a.message);else if(a.done)Solo.Restore.factory=a.factory,document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-extract-ok").style.display="block";else{Solo.Restore.statistics.inbytes+=a.bytesIn;Solo.Restore.statistics.outbytes+=a.bytesOut;Solo.Restore.statistics.files+=a.files;try{document.getElementById("extbytesin").textContent=Solo.Restore.statistics.inbytes,
document.getElementById("extbytesout").textContent=Solo.Restore.statistics.outbytes,document.getElementById("extfiles").textContent=Solo.Restore.statistics.files}catch(b){}post={task:"stepRestore",factory:a.factory};Solo.Restore.startTimeoutBar(5E3,80);Solo.Restore.doAjax(post,function(a){Solo.Restore.step(a)})}};Solo.Restore.finalize=function(){var a={task:"finalizeRestore",factory:Solo.Restore.factory};Solo.Restore.startTimeoutBar(5E3,80);Solo.Restore.doAjax(a,function(a){Solo.Restore.finished(a)})};
Solo.Restore.finished=function(){window.location=Solo.Restore.mainURL};Solo.Restore.runInstaller=function(a){window.open(a+"/../installation/index.php","abiinstaller");a=document.getElementById("restoration-runinstaller");var b=document.getElementById("restoration-finalize");Solo.System.removeClass(a,"btn-large btn-success");Solo.System.addClass(a,"btn-inverse btn-small");b.style.display="block"};
Solo.Restore.restoreDefaultOptions=function(){var a=document.getElementById("jps_key");a&&(a.value="ChromeIsDumb",a.value="")};Solo.Restore.onProcEngineChange=function(a){a=document.getElementById("procengine").value;var b=document.getElementById("ftpOptions"),d=document.getElementById("var[ftp.test]");b.style.display="none";d.style.display="none";"direct"!=a&&(b.style.display="block",d.style.display="inline-block")}; //# sourceMappingURL=restore.min.map
